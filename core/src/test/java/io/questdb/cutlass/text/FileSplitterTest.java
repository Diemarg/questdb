package io.questdb.cutlass.text;

import io.questdb.Metrics;
import io.questdb.WorkerPoolAwareConfiguration;
import io.questdb.cairo.CairoConfiguration;
import io.questdb.cairo.CairoEngine;
import io.questdb.cairo.DefaultCairoConfiguration;
import io.questdb.cairo.PartitionBy;
import io.questdb.cairo.vm.*;
import io.questdb.griffin.*;
import io.questdb.mp.WorkerPool;
import io.questdb.std.*;
import io.questdb.std.datetime.DateFormat;
import io.questdb.std.datetime.microtime.TimestampFormatCompiler;
import io.questdb.std.str.Path;
import io.questdb.test.tools.TestUtils;
import org.jetbrains.annotations.Nullable;
import org.junit.Assert;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.Test;

import java.io.*;
import java.util.*;

/**
 *
 */
public class FileSplitterTest extends AbstractGriffinTest {
    private static final Rnd rnd = new Rnd();

    //test csv with timestamp over buffer boundaries
    //test csv with timestamp over buffer boundaries that's too long 
    //test csv with bad timestamp value 
    //test csv with quoted field that is too long and doesn't end before newline (should make a mess also with TextLexer/TextLoader)

    @Before
    public void before() throws IOException {
        rnd.reset();
        inputRoot = new File(".").getAbsolutePath();
        if (inputWorkRoot == null) {
            inputWorkRoot = temp.newFolder("imports" + System.currentTimeMillis()).getAbsolutePath();
        }
    }

    @Test
    public void testFindChunkBoundariesForEmptyFile() throws Exception {
        executeWithPool(3, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                assertChunkBoundariesFor("test-quotes-empty.csv", null, sqlExecutionContext)
        );
    }

    @Test
    public void testFindChunkBoundariesForFileWithNoQuotes() throws Exception {
        executeWithPool(3, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                assertChunkBoundariesFor("test-import.csv", list(0, 0, 4565, 44, 9087, 87, 13612, 130), sqlExecutionContext)
        );
    }

    @Test
    public void testFindChunkBoundariesWith1WorkerForFileWithLongLines() throws Exception {
        executeWithPool(1, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                assertChunkBoundariesFor("test-quotes-small.csv", list(0, 0, 241, 0), sqlExecutionContext)
        );
    }

    @Test
    public void testFindChunkBoundariesForFileWithLongLines() throws Exception {
        executeWithPool(3, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                assertChunkBoundariesFor("test-quotes-small.csv", list(0, 0, 170, 2, 241, 3), sqlExecutionContext)
        );
    }

    @Test
    public void testFindChunkBoundariesInFileWithOneLongLine() throws Exception {
        executeWithPool(2, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                assertChunkBoundariesFor("test-quotes-oneline.csv", list(0, 0, 234, 1), sqlExecutionContext)
        );
    }

    @Test
    public void testFindChunkBoundariesInFileWithOneLongLineWithManyWorkers() throws Exception {
        executeWithPool(7, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                assertChunkBoundariesFor("test-quotes-oneline.csv", list(0, 0, 234, 1), sqlExecutionContext)
        );
    }

    @Test
    public void testFindChunkBoundariesInLargerCsv() throws Exception {
        executeWithPool(4, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                assertChunkBoundariesFor("test-quotes-big.csv", list(0, 0, 16797, 254, 33514, 503, 50216, 752, 66923, 1001), sqlExecutionContext)
        );
    }

    @Test
    public void testIndexMerge() throws Exception {
        FilesFacade ff = engine.getConfiguration().getFilesFacade();
        try (Path path = new Path().of(inputRoot).slash().concat("chunks")) {
            int plen = path.length();
            path.concat("part").slash$();

            if (!ff.exists(path)) {
                int result = ff.mkdirs(path, engine.getConfiguration().getMkDirMode());
                if (result != 0) {
                    LOG.info().$("Couldn't create partition dir=").$(path).$();//TODO: maybe we can ignore it
                }
            }
            int chunks = 10;
            createAndSortChunkFiles(path, chunks, 10_000, 1_000_000);

            try (FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {
                path.trimTo(plen);
//                indexer.mergePartitionIndexes(path.$(), chunks);
                //todo: test!!
            }
            path.trimTo(plen);
            ff.rmdir(path.$()); // clean all
        }
    }

    @Ignore
    @Test
    public void testProcessLargeCsvWithPool() throws Exception {
        executeWithPool(8, 16, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) -> {
            //String inputDir = new File(".").getAbsolutePath();
            inputRoot = new File("E:/dev/tmp").getAbsolutePath();

            //try (Path path = new Path().of(inputDir).slash().concat("src/test/resources/csv/test-import.csv").$();
            try (FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {

                DateFormat dateFormat = new TimestampFormatCompiler().compile("yyyy-MM-ddTHH:mm:ss.SSSUUUZ");
                //trips300mil.csv
                indexer.of("unordered_trips_300mil.csv", PartitionBy.HOUR, (byte) ',', 2, dateFormat, true);
                indexer.process();
            }
        });
    }

    private LongList list(long... values) {
        LongList result = new LongList();
        for (long l : values) {
            result.add(l);
        }
        return result;
    }

    private void assertChunkBoundariesFor(String fileName, LongList expectedBoundaries, SqlExecutionContext sqlExecutionContext) throws SqlException, IOException {
        FilesFacade ff = engine.getConfiguration().getFilesFacade();
        inputRoot = new File("./src/test/resources/csv/").getAbsolutePath();

        try (Path path = new Path().of(inputRoot).slash().concat(fileName).$();
             FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {
            indexer.setMinChunkSize(1);
            indexer.of(fileName, PartitionBy.DAY, (byte) ',', -1, null, false);

            long fd = ff.openRO(path);
            Assert.assertTrue(fd > -1);

            try {
                LongList actualBoundaries = indexer.findChunkBoundaries(fd);
                Assert.assertEquals(expectedBoundaries, actualBoundaries);
            } finally {
                ff.close(fd);
            }
        }
    }

    @Test
    public void testIndexChunksInSmallCsvWith1Worker() throws Exception {
        assertIndexChunks(1, "test-quotes-small.csv",
                chunk("2022-05-10/0_1", 1652183520000000L, 0L),
                chunk("2022-05-11/0_1", 1652269920000000L, 75L, 1652269920001000L, 170L));
    }

    @Test
    public void testIndexChunksInSmallCsvWith2Workers() throws Exception {
        assertIndexChunks(2, "test-quotes-small.csv",
                chunk("2022-05-10/0_1", 1652183520000000L, 0L),
                chunk("2022-05-11/0_1", 1652269920000000L, 75L),
                chunk("2022-05-11/1_1", 1652269920001000L, 170L));
    }

    @Test
    public void testIndexChunksInSmallCsvWith3Workers() throws Exception {
        assertIndexChunks(3, "test-quotes-small.csv",
                chunk("2022-05-10/0_1", 1652183520000000L, 0L),
                chunk("2022-05-11/0_1", 1652269920000000L, 75L),
                chunk("2022-05-11/1_1", 1652269920001000L, 170L));
    }

    @Test
    public void testIndexChunksInSmallCsvWith4Workers() throws Exception {
        assertIndexChunks(4, "test-quotes-small.csv",
                chunk("2022-05-10/0_1", 1652183520000000L, 0L),
                chunk("2022-05-11/1_1", 1652269920000000L, 75L),
                chunk("2022-05-11/2_1", 1652269920001000L, 170L));
    }

    @Test
    public void testIndexChunksInSingleLineCsvWithPool() throws Exception {
        assertIndexChunks(4, "test-quotes-oneline.csv",
                chunk("2022-05-14/0_1", 1652529121000000L, 0L));
    }

    @Test
    public void testIndexChunksInEmptyCsv() throws Exception {
        assertIndexChunks(4, "test-quotes-empty.csv");
    }

    //FIX
    @Ignore
    @Test//timestamp should be reassembled properly via rolling buffer
    public void testIndexChunksInEmptyCsvWithTimestampFieldSplitBetweenReadBuffers() throws Exception {
        assertIndexChunks(4, "yyyy-MM-ddTHH:mm:ss.SSSZ", PartitionBy.DAY, 1, "test-quotes-small.csv");
    }

    //FIX
    @Ignore
    @Test//timestamp is ignored if it doesn't fit in ts rolling buffer 
    public void testIndexChunksInEmptyCsvWithTooLongTimestampFieldSplitBetweenReadBuffers() throws Exception {
        assertIndexChunks(4, "test-quotes-small.csv");
    }

    @Test
    public void testIndexChunksInBigCsv() throws Exception { //buffer = 93
        assertIndexChunks(4, "yyyy-MM-ddTHH:mm:ss.SSSUUUZ", PartitionBy.YEAR, "test-quotes-big.csv",
                chunk("1970/0_1", 86400000000L, 31L, 172800000000L, 94L, 259200000000L, 157L, 345600000000L, 220L, 432000000000L, 283L, 518400000000L, 346L, 604800000000L, 409L, 691200000000L, 472L, 777600000000L, 535L, 864000000000L, 598L, 950400000000L, 663L, 1036800000000L, 728L, 1123200000000L, 794L, 1209600000000L, 859L, 1296000000000L, 924L, 1382400000000L, 989L, 1468800000000L, 1054L, 1555200000000L, 1119L, 1641600000000L, 1184L, 1728000000000L, 1249L, 1814400000000L, 1315L, 1900800000000L, 1380L, 1987200000000L, 1445L, 2073600000000L, 1510L, 2160000000000L, 1575L, 2246400000000L, 1640L, 2332800000000L, 1705L, 2419200000000L, 1771L, 2505600000000L, 1836L, 2592000000000L, 1902L, 2678400000000L, 1972L, 2764800000000L, 2037L, 2851200000000L, 2102L, 2937600000000L, 2168L, 3024000000000L, 2233L, 3110400000000L, 2298L, 3196800000000L, 2363L, 3283200000000L, 2428L, 3369600000000L, 2493L, 3456000000000L, 2558L, 3542400000000L, 2623L, 3628800000000L, 2688L, 3715200000000L, 2753L, 3801600000000L, 2818L, 3888000000000L, 2883L, 3974400000000L, 2948L, 4060800000000L, 3013L, 4147200000000L, 3078L, 4233600000000L, 3143L, 4320000000000L, 3208L, 4406400000000L, 3274L, 4492800000000L, 3339L, 4579200000000L, 3404L, 4665600000000L, 3469L, 4752000000000L, 3534L, 4838400000000L, 3599L, 4924800000000L, 3664L, 5011200000000L, 3729L, 5097600000000L, 3794L, 5184000000000L, 3860L, 5270400000000L, 3925L, 5356800000000L, 3990L, 5443200000000L, 4055L, 5529600000000L, 4120L, 5616000000000L, 4185L, 5702400000000L, 4250L, 5788800000000L, 4315L, 5875200000000L, 4380L, 5961600000000L, 4445L, 6048000000000L, 4510L, 6134400000000L, 4575L, 6220800000000L, 4640L, 6307200000000L, 4705L, 6393600000000L, 4770L, 6480000000000L, 4835L, 6566400000000L, 4900L, 6652800000000L, 4965L, 6739200000000L, 5031L, 6825600000000L, 5096L, 6912000000000L, 5161L, 6998400000000L, 5226L, 7084800000000L, 5291L, 7171200000000L, 5356L, 7257600000000L, 5421L, 7344000000000L, 5486L, 7430400000000L, 5551L, 7516800000000L, 5616L, 7603200000000L, 5681L, 7689600000000L, 5746L, 7776000000000L, 5811L, 7862400000000L, 5876L, 7948800000000L, 5941L, 8035200000000L, 6006L, 8121600000000L, 6071L, 8208000000000L, 6136L, 8294400000000L, 6201L, 8380800000000L, 6266L, 8467200000000L, 6331L, 8553600000000L, 6396L, 8640000000000L, 6461L, 8726400000000L, 6528L, 8812800000000L, 6595L, 8899200000000L, 6662L, 8985600000000L, 6729L, 9072000000000L, 6796L, 9158400000000L, 6863L, 9244800000000L, 6930L, 9331200000000L, 6997L, 9417600000000L, 7064L, 9504000000000L, 7131L, 9590400000000L, 7198L, 9676800000000L, 7265L, 9763200000000L, 7332L, 9849600000000L, 7399L, 9936000000000L, 7466L, 10022400000000L, 7534L, 10108800000000L, 7601L, 10195200000000L, 7668L, 10281600000000L, 7735L, 10368000000000L, 7802L, 10454400000000L, 7869L, 10540800000000L, 7936L, 10627200000000L, 8003L, 10713600000000L, 8070L, 10800000000000L, 8137L, 10886400000000L, 8204L, 10972800000000L, 8271L, 11059200000000L, 8339L, 11145600000000L, 8406L, 11232000000000L, 8473L, 11318400000000L, 8540L, 11404800000000L, 8607L, 11491200000000L, 8674L, 11577600000000L, 8741L, 11664000000000L, 8808L, 11750400000000L, 8875L, 11836800000000L, 8942L, 11923200000000L, 9009L, 12009600000000L, 9076L, 12096000000000L, 9143L, 12182400000000L, 9210L, 12268800000000L, 9278L, 12355200000000L, 9345L, 12441600000000L, 9412L, 12528000000000L, 9480L, 12614400000000L, 9547L, 12700800000000L, 9614L, 12787200000000L, 9681L, 12873600000000L, 9748L, 12960000000000L, 9815L, 13046400000000L, 9882L, 13132800000000L, 9949L, 13219200000000L, 10017L, 13305600000000L, 10084L, 13392000000000L, 10151L, 13478400000000L, 10218L, 13564800000000L, 10287L, 13651200000000L, 10354L, 13737600000000L, 10421L, 13824000000000L, 10488L, 13910400000000L, 10555L, 13996800000000L, 10622L, 14083200000000L, 10689L, 14169600000000L, 10756L, 14256000000000L, 10823L, 14342400000000L, 10890L, 14428800000000L, 10957L, 14515200000000L, 11024L, 14601600000000L, 11091L, 14688000000000L, 11158L, 14774400000000L, 11226L, 14860800000000L, 11293L, 14947200000000L, 11360L, 15033600000000L, 11427L, 15120000000000L, 11494L, 15206400000000L, 11561L, 15292800000000L, 11628L, 15379200000000L, 11695L, 15465600000000L, 11762L, 15552000000000L, 11829L, 15638400000000L, 11896L, 15724800000000L, 11963L, 15811200000000L, 12030L, 15897600000000L, 12097L, 15984000000000L, 12164L, 16070400000000L, 12231L, 16156800000000L, 12299L, 16243200000000L, 12366L, 16329600000000L, 12434L, 16416000000000L, 12501L, 16502400000000L, 12568L, 16588800000000L, 12635L, 16675200000000L, 12702L, 16761600000000L, 12769L, 16848000000000L, 12836L, 16934400000000L, 12903L, 17020800000000L, 12970L, 17107200000000L, 13037L, 17193600000000L, 13104L, 17280000000000L, 13172L, 17366400000000L, 13240L, 17452800000000L, 13307L, 17539200000000L, 13374L, 17625600000000L, 13441L, 17712000000000L, 13508L, 17798400000000L, 13575L, 17884800000000L, 13642L, 17971200000000L, 13710L, 18057600000000L, 13777L, 18144000000000L, 13844L, 18230400000000L, 13911L, 18316800000000L, 13978L, 18403200000000L, 14045L, 18489600000000L, 14112L, 18576000000000L, 14179L, 18662400000000L, 14246L, 18748800000000L, 14313L, 18835200000000L, 14380L, 18921600000000L, 14447L, 19008000000000L, 14514L, 19094400000000L, 14581L, 19180800000000L, 14649L, 19267200000000L, 14716L, 19353600000000L, 14783L, 19440000000000L, 14851L, 19526400000000L, 14918L, 19612800000000L, 14985L, 19699200000000L, 15052L, 19785600000000L, 15120L, 19872000000000L, 15187L, 19958400000000L, 15254L, 20044800000000L, 15321L, 20131200000000L, 15388L, 20217600000000L, 15455L, 20304000000000L, 15523L, 20390400000000L, 15590L, 20476800000000L, 15657L, 20563200000000L, 15725L, 20649600000000L, 15792L, 20736000000000L, 15859L, 20822400000000L, 15926L, 20908800000000L, 15993L, 20995200000000L, 16060L, 21081600000000L, 16127L, 21168000000000L, 16194L, 21254400000000L, 16261L, 21340800000000L, 16328L, 21427200000000L, 16395L, 21513600000000L, 16462L, 21600000000000L, 16529L, 21686400000000L, 16596L, 21772800000000L, 16663L, 21859200000000L, 16730),
                chunk("1970/1_1", 21945600000000L, 16797L, 22032000000000L, 16864L, 22118400000000L, 16931L, 22204800000000L, 16999L, 22291200000000L, 17066L, 22377600000000L, 17133L, 22464000000000L, 17200L, 22550400000000L, 17267L, 22636800000000L, 17334L, 22723200000000L, 17401L, 22809600000000L, 17468L, 22896000000000L, 17535L, 22982400000000L, 17602L, 23068800000000L, 17669L, 23155200000000L, 17736L, 23241600000000L, 17803L, 23328000000000L, 17870L, 23414400000000L, 17937L, 23500800000000L, 18004L, 23587200000000L, 18071L, 23673600000000L, 18138L, 23760000000000L, 18207L, 23846400000000L, 18274L, 23932800000000L, 18341L, 24019200000000L, 18408L, 24105600000000L, 18475L, 24192000000000L, 18542L, 24278400000000L, 18609L, 24364800000000L, 18676L, 24451200000000L, 18743L, 24537600000000L, 18810L, 24624000000000L, 18878L, 24710400000000L, 18945L, 24796800000000L, 19012L, 24883200000000L, 19079L, 24969600000000L, 19146L, 25056000000000L, 19213L, 25142400000000L, 19280L, 25228800000000L, 19347L, 25315200000000L, 19414L, 25401600000000L, 19481L, 25488000000000L, 19548L, 25574400000000L, 19615L, 25660800000000L, 19682L, 25747200000000L, 19749L, 25833600000000L, 19816L, 25920000000000L, 19883L, 26006400000000L, 19950L, 26092800000000L, 20017L, 26179200000000L, 20084L, 26265600000000L, 20151L, 26352000000000L, 20218L, 26438400000000L, 20285L, 26524800000000L, 20352L, 26611200000000L, 20420L, 26697600000000L, 20487L, 26784000000000L, 20554L, 26870400000000L, 20621L, 26956800000000L, 20688L, 27043200000000L, 20755L, 27129600000000L, 20822L, 27216000000000L, 20889L, 27302400000000L, 20956L, 27388800000000L, 21023L, 27475200000000L, 21090L, 27561600000000L, 21157L, 27648000000000L, 21224L, 27734400000000L, 21291L, 27820800000000L, 21358L, 27907200000000L, 21426L, 27993600000000L, 21493L, 28080000000000L, 21560L, 28166400000000L, 21629L, 28252800000000L, 21696L, 28339200000000L, 21763L, 28425600000000L, 21830L, 28512000000000L, 21897L, 28598400000000L, 21964L, 28684800000000L, 22031L, 28771200000000L, 22100L, 28857600000000L, 22167L, 28944000000000L, 22234L, 29030400000000L, 22301L, 29116800000000L, 22368L, 29203200000000L, 22435L, 29289600000000L, 22502L, 29376000000000L, 22569L, 29462400000000L, 22636L, 29548800000000L, 22703L, 29635200000000L, 22770L, 29721600000000L, 22837L, 29808000000000L, 22904L, 29894400000000L, 22971L, 29980800000000L, 23038L, 30067200000000L, 23105L, 30153600000000L, 23172L, 30240000000000L, 23240L, 30326400000000L, 23307L, 30412800000000L, 23374L, 30499200000000L, 23441L, 30585600000000L, 23508L, 30672000000000L, 23575L, 30758400000000L, 23643L, 30844800000000L, 23711L, 30931200000000L, 23778L, 31017600000000L, 23845L, 31104000000000L, 23913L, 31190400000000L, 23980L, 31276800000000L, 24047L, 31363200000000L, 24115L, 31449600000000L, 24182),
                chunk("1971/1_1", 31536000000000L, 24249L, 31622400000000L, 24316L, 31708800000000L, 24383L, 31795200000000L, 24450L, 31881600000000L, 24517L, 31968000000000L, 24584L, 32054400000000L, 24651L, 32140800000000L, 24718L, 32227200000000L, 24786L, 32313600000000L, 24853L, 32400000000000L, 24920L, 32486400000000L, 24987L, 32572800000000L, 25054L, 32659200000000L, 25122L, 32745600000000L, 25189L, 32832000000000L, 25256L, 32918400000000L, 25323L, 33004800000000L, 25390L, 33091200000000L, 25457L, 33177600000000L, 25524L, 33264000000000L, 25591L, 33350400000000L, 25658L, 33436800000000L, 25725L, 33523200000000L, 25792L, 33609600000000L, 25859L, 33696000000000L, 25927L, 33782400000000L, 25994L, 33868800000000L, 26062L, 33955200000000L, 26129L, 34041600000000L, 26196L, 34128000000000L, 26263L, 34214400000000L, 26330L, 34300800000000L, 26397L, 34387200000000L, 26464L, 34473600000000L, 26531L, 34560000000000L, 26598L, 34646400000000L, 26665L, 34732800000000L, 26733L, 34819200000000L, 26800L, 34905600000000L, 26867L, 34992000000000L, 26934L, 35078400000000L, 27001L, 35164800000000L, 27069L, 35251200000000L, 27136L, 35337600000000L, 27203L, 35424000000000L, 27270L, 35510400000000L, 27337L, 35596800000000L, 27405L, 35683200000000L, 27472L, 35769600000000L, 27539L, 35856000000000L, 27607L, 35942400000000L, 27674L, 36028800000000L, 27741L, 36115200000000L, 27808L, 36201600000000L, 27875L, 36288000000000L, 27942L, 36374400000000L, 28009L, 36460800000000L, 28076L, 36547200000000L, 28143L, 36633600000000L, 28210L, 36720000000000L, 28278L, 36806400000000L, 28347L, 36892800000000L, 28414L, 36979200000000L, 28482L, 37065600000000L, 28549L, 37152000000000L, 28616L, 37238400000000L, 28683L, 37324800000000L, 28750L, 37411200000000L, 28817L, 37497600000000L, 28884L, 37584000000000L, 28951L, 37670400000000L, 29018L, 37756800000000L, 29085L, 37843200000000L, 29152L, 37929600000000L, 29219L, 38016000000000L, 29286L, 38102400000000L, 29353L, 38188800000000L, 29421L, 38275200000000L, 29488L, 38361600000000L, 29555L, 38448000000000L, 29622L, 38534400000000L, 29690L, 38620800000000L, 29758L, 38707200000000L, 29825L, 38793600000000L, 29892L, 38880000000000L, 29959L, 38966400000000L, 30026L, 39052800000000L, 30093L, 39139200000000L, 30160L, 39225600000000L, 30229L, 39312000000000L, 30296L, 39398400000000L, 30363L, 39484800000000L, 30430L, 39571200000000L, 30497L, 39657600000000L, 30564L, 39744000000000L, 30631L, 39830400000000L, 30698L, 39916800000000L, 30765L, 40003200000000L, 30832L, 40089600000000L, 30899L, 40176000000000L, 30966L, 40262400000000L, 31033L, 40348800000000L, 31100L, 40435200000000L, 31167L, 40521600000000L, 31234L, 40608000000000L, 31301L, 40694400000000L, 31368L, 40780800000000L, 31435L, 40867200000000L, 31502L, 40953600000000L, 31569L, 41040000000000L, 31636L, 41126400000000L, 31703L, 41212800000000L, 31770L, 41299200000000L, 31838L, 41385600000000L, 31905L, 41472000000000L, 31972L, 41558400000000L, 32039L, 41644800000000L, 32106L, 41731200000000L, 32173L, 41817600000000L, 32240L, 41904000000000L, 32307L, 41990400000000L, 32374L, 42076800000000L, 32441L, 42163200000000L, 32508L, 42249600000000L, 32575L, 42336000000000L, 32643L, 42422400000000L, 32710L, 42508800000000L, 32777L, 42595200000000L, 32844L, 42681600000000L, 32911L, 42768000000000L, 32978L, 42854400000000L, 33045L, 42940800000000L, 33112L, 43027200000000L, 33179L, 43113600000000L, 33246L, 43200000000000L, 33313L, 43286400000000L, 33380L, 43372800000000L, 33447),
                chunk("1971/2_1", 43459200000000L, 33514L, 43545600000000L, 33581L, 43632000000000L, 33648L, 43718400000000L, 33715L, 43804800000000L, 33782L, 43891200000000L, 33849L, 43977600000000L, 33916L, 44064000000000L, 33983L, 44150400000000L, 34050L, 44236800000000L, 34117L, 44323200000000L, 34184L, 44409600000000L, 34251L, 44496000000000L, 34318L, 44582400000000L, 34385L, 44668800000000L, 34452L, 44755200000000L, 34519L, 44841600000000L, 34586L, 44928000000000L, 34653L, 45014400000000L, 34720L, 45100800000000L, 34787L, 45187200000000L, 34854L, 45273600000000L, 34921L, 45360000000000L, 34989L, 45446400000000L, 35056L, 45532800000000L, 35123L, 45619200000000L, 35190L, 45705600000000L, 35257L, 45792000000000L, 35324L, 45878400000000L, 35391L, 45964800000000L, 35458L, 46051200000000L, 35525L, 46137600000000L, 35592L, 46224000000000L, 35659L, 46310400000000L, 35726L, 46396800000000L, 35793L, 46483200000000L, 35860L, 46569600000000L, 35928L, 46656000000000L, 35995L, 46742400000000L, 36062L, 46828800000000L, 36129L, 46915200000000L, 36196L, 47001600000000L, 36263L, 47088000000000L, 36330L, 47174400000000L, 36397L, 47260800000000L, 36464L, 47347200000000L, 36531L, 47433600000000L, 36599L, 47520000000000L, 36666L, 47606400000000L, 36733L, 47692800000000L, 36801L, 47779200000000L, 36868L, 47865600000000L, 36935L, 47952000000000L, 37002L, 48038400000000L, 37069L, 48124800000000L, 37137L, 48211200000000L, 37205L, 48297600000000L, 37272L, 48384000000000L, 37339L, 48470400000000L, 37406L, 48556800000000L, 37473L, 48643200000000L, 37540L, 48729600000000L, 37607L, 48816000000000L, 37674L, 48902400000000L, 37741L, 48988800000000L, 37808L, 49075200000000L, 37875L, 49161600000000L, 37942L, 49248000000000L, 38009L, 49334400000000L, 38076L, 49420800000000L, 38143L, 49507200000000L, 38210L, 49593600000000L, 38277L, 49680000000000L, 38344L, 49766400000000L, 38411L, 49852800000000L, 38478L, 49939200000000L, 38545L, 50025600000000L, 38613L, 50112000000000L, 38680L, 50198400000000L, 38747L, 50284800000000L, 38814L, 50371200000000L, 38881L, 50457600000000L, 38948L, 50544000000000L, 39016L, 50630400000000L, 39083L, 50716800000000L, 39150L, 50803200000000L, 39217L, 50889600000000L, 39284L, 50976000000000L, 39351L, 51062400000000L, 39418L, 51148800000000L, 39485L, 51235200000000L, 39552L, 51321600000000L, 39619L, 51408000000000L, 39687L, 51494400000000L, 39754L, 51580800000000L, 39821L, 51667200000000L, 39888L, 51753600000000L, 39956L, 51840000000000L, 40023L, 51926400000000L, 40090L, 52012800000000L, 40157L, 52099200000000L, 40224L, 52185600000000L, 40291L, 52272000000000L, 40358L, 52358400000000L, 40425L, 52444800000000L, 40492L, 52531200000000L, 40559L, 52617600000000L, 40626L, 52704000000000L, 40693L, 52790400000000L, 40760L, 52876800000000L, 40827L, 52963200000000L, 40894L, 53049600000000L, 40962L, 53136000000000L, 41029L, 53222400000000L, 41096L, 53308800000000L, 41163L, 53395200000000L, 41230L, 53481600000000L, 41297L, 53568000000000L, 41364L, 53654400000000L, 41431L, 53740800000000L, 41498L, 53827200000000L, 41565L, 53913600000000L, 41632L, 54000000000000L, 41699L, 54086400000000L, 41767L, 54172800000000L, 41834L, 54259200000000L, 41901L, 54345600000000L, 41968L, 54432000000000L, 42035L, 54518400000000L, 42102L, 54604800000000L, 42169L, 54691200000000L, 42236L, 54777600000000L, 42303L, 54864000000000L, 42370L, 54950400000000L, 42437L, 55036800000000L, 42504L, 55123200000000L, 42571L, 55209600000000L, 42638L, 55296000000000L, 42705L, 55382400000000L, 42772L, 55468800000000L, 42839L, 55555200000000L, 42906L, 55641600000000L, 42973L, 55728000000000L, 43040L, 55814400000000L, 43107L, 55900800000000L, 43174L, 55987200000000L, 43241L, 56073600000000L, 43308L, 56160000000000L, 43375L, 56246400000000L, 43442L, 56332800000000L, 43509L, 56419200000000L, 43576L, 56505600000000L, 43643L, 56592000000000L, 43710L, 56678400000000L, 43777L, 56764800000000L, 43844L, 56851200000000L, 43911L, 56937600000000L, 43978L, 57024000000000L, 44046L, 57110400000000L, 44113L, 57196800000000L, 44180L, 57283200000000L, 44247L, 57369600000000L, 44314L, 57456000000000L, 44381L, 57542400000000L, 44448L, 57628800000000L, 44516L, 57715200000000L, 44583L, 57801600000000L, 44650L, 57888000000000L, 44717L, 57974400000000L, 44784L, 58060800000000L, 44851L, 58147200000000L, 44918L, 58233600000000L, 44985L, 58320000000000L, 45052L, 58406400000000L, 45119L, 58492800000000L, 45186L, 58579200000000L, 45253L, 58665600000000L, 45320L, 58752000000000L, 45387L, 58838400000000L, 45454L, 58924800000000L, 45521L, 59011200000000L, 45588L, 59097600000000L, 45655L, 59184000000000L, 45722L, 59270400000000L, 45789L, 59356800000000L, 45856L, 59443200000000L, 45923L, 59529600000000L, 45990L, 59616000000000L, 46058L, 59702400000000L, 46125L, 59788800000000L, 46192L, 59875200000000L, 46259L, 59961600000000L, 46326L, 60048000000000L, 46393L, 60134400000000L, 46460L, 60220800000000L, 46527L, 60307200000000L, 46594L, 60393600000000L, 46661L, 60480000000000L, 46728L, 60566400000000L, 46795L, 60652800000000L, 46862L, 60739200000000L, 46929L, 60825600000000L, 46996L, 60912000000000L, 47063L, 60998400000000L, 47130L, 61084800000000L, 47197L, 61171200000000L, 47264L, 61257600000000L, 47331L, 61344000000000L, 47398L, 61430400000000L, 47465L, 61516800000000L, 47532L, 61603200000000L, 47599L, 61689600000000L, 47666L, 61776000000000L, 47733L, 61862400000000L, 47800L, 61948800000000L, 47867L, 62035200000000L, 47934L, 62121600000000L, 48001L, 62208000000000L, 48068L, 62294400000000L, 48135L, 62380800000000L, 48202L, 62467200000000L, 48269L, 62553600000000L, 48336L, 62640000000000L, 48403L, 62726400000000L, 48470L, 62812800000000L, 48537L, 62899200000000L, 48604L, 62985600000000L, 48671),
                chunk("1972/2_1", 63072000000000L, 48738L, 63158400000000L, 48806L, 63244800000000L, 48873L, 63331200000000L, 48940L, 63417600000000L, 49007L, 63504000000000L, 49074L, 63590400000000L, 49142L, 63676800000000L, 49209L, 63763200000000L, 49276L, 63849600000000L, 49344L, 63936000000000L, 49411L, 64022400000000L, 49478L, 64108800000000L, 49545L, 64195200000000L, 49612L, 64281600000000L, 49679L, 64368000000000L, 49746L, 64454400000000L, 49813L, 64540800000000L, 49881L, 64627200000000L, 49948L, 64713600000000L, 50015L, 64800000000000L, 50082L, 64886400000000L, 50149),
                chunk("1972/3_1", 64972800000000L, 50216L, 65059200000000L, 50283L, 65145600000000L, 50350L, 65232000000000L, 50417L, 65318400000000L, 50484L, 65404800000000L, 50551L, 65491200000000L, 50618L, 65577600000000L, 50685L, 65664000000000L, 50752L, 65750400000000L, 50819L, 65836800000000L, 50886L, 65923200000000L, 50953L, 66009600000000L, 51020L, 66096000000000L, 51087L, 66182400000000L, 51154L, 66268800000000L, 51221L, 66355200000000L, 51288L, 66441600000000L, 51355L, 66528000000000L, 51422L, 66614400000000L, 51489L, 66700800000000L, 51556L, 66787200000000L, 51623L, 66873600000000L, 51691L, 66960000000000L, 51758L, 67046400000000L, 51825L, 67132800000000L, 51892L, 67219200000000L, 51959L, 67305600000000L, 52026L, 67392000000000L, 52093L, 67478400000000L, 52160L, 67564800000000L, 52227L, 67651200000000L, 52294L, 67737600000000L, 52361L, 67824000000000L, 52429L, 67910400000000L, 52497L, 67996800000000L, 52564L, 68083200000000L, 52631L, 68169600000000L, 52698L, 68256000000000L, 52765L, 68342400000000L, 52832L, 68428800000000L, 52899L, 68515200000000L, 52966L, 68601600000000L, 53033L, 68688000000000L, 53100L, 68774400000000L, 53167L, 68860800000000L, 53234L, 68947200000000L, 53301L, 69033600000000L, 53368L, 69120000000000L, 53435L, 69206400000000L, 53502L, 69292800000000L, 53569L, 69379200000000L, 53636L, 69465600000000L, 53703L, 69552000000000L, 53770L, 69638400000000L, 53837L, 69724800000000L, 53904L, 69811200000000L, 53972L, 69897600000000L, 54039L, 69984000000000L, 54106L, 70070400000000L, 54173L, 70156800000000L, 54240L, 70243200000000L, 54307L, 70329600000000L, 54374L, 70416000000000L, 54441L, 70502400000000L, 54508L, 70588800000000L, 54575L, 70675200000000L, 54642L, 70761600000000L, 54709L, 70848000000000L, 54776L, 70934400000000L, 54843L, 71020800000000L, 54910L, 71107200000000L, 54977L, 71193600000000L, 55044L, 71280000000000L, 55111L, 71366400000000L, 55178L, 71452800000000L, 55246L, 71539200000000L, 55313L, 71625600000000L, 55380L, 71712000000000L, 55447L, 71798400000000L, 55514L, 71884800000000L, 55581L, 71971200000000L, 55648L, 72057600000000L, 55715L, 72144000000000L, 55782L, 72230400000000L, 55849L, 72316800000000L, 55916L, 72403200000000L, 55983L, 72489600000000L, 56050L, 72576000000000L, 56117L, 72662400000000L, 56184L, 72748800000000L, 56251L, 72835200000000L, 56318L, 72921600000000L, 56385L, 73008000000000L, 56452L, 73094400000000L, 56519L, 73180800000000L, 56586L, 73267200000000L, 56653L, 73353600000000L, 56720L, 73440000000000L, 56787L, 73526400000000L, 56854L, 73612800000000L, 56921L, 73699200000000L, 56988L, 73785600000000L, 57055L, 73872000000000L, 57122L, 73958400000000L, 57189L, 74044800000000L, 57256L, 74131200000000L, 57323L, 74217600000000L, 57390L, 74304000000000L, 57457L, 74390400000000L, 57524L, 74476800000000L, 57591L, 74563200000000L, 57658L, 74649600000000L, 57725L, 74736000000000L, 57792L, 74822400000000L, 57859L, 74908800000000L, 57926L, 74995200000000L, 57993L, 75081600000000L, 58060L, 75168000000000L, 58127L, 75254400000000L, 58194L, 75340800000000L, 58261L, 75427200000000L, 58328L, 75513600000000L, 58395L, 75600000000000L, 58462L, 75686400000000L, 58529L, 75772800000000L, 58596L, 75859200000000L, 58663L, 75945600000000L, 58731L, 76032000000000L, 58798L, 76118400000000L, 58865L, 76204800000000L, 58933L, 76291200000000L, 59000L, 76377600000000L, 59068L, 76464000000000L, 59135L, 76550400000000L, 59202L, 76636800000000L, 59269L, 76723200000000L, 59336L, 76809600000000L, 59403L, 76896000000000L, 59470L, 76982400000000L, 59537L, 77068800000000L, 59604L, 77155200000000L, 59671L, 77241600000000L, 59738L, 77328000000000L, 59805L, 77414400000000L, 59872L, 77500800000000L, 59939L, 77587200000000L, 60007L, 77673600000000L, 60074L, 77760000000000L, 60142L, 77846400000000L, 60209L, 77932800000000L, 60276L, 78019200000000L, 60343L, 78105600000000L, 60410L, 78192000000000L, 60477L, 78278400000000L, 60544L, 78364800000000L, 60611L, 78451200000000L, 60678L, 78537600000000L, 60745L, 78624000000000L, 60812L, 78710400000000L, 60879L, 78796800000000L, 60946L, 78883200000000L, 61013L, 78969600000000L, 61080L, 79056000000000L, 61147L, 79142400000000L, 61215L, 79228800000000L, 61282L, 79315200000000L, 61349L, 79401600000000L, 61416L, 79488000000000L, 61483L, 79574400000000L, 61550L, 79660800000000L, 61617L, 79747200000000L, 61684L, 79833600000000L, 61751L, 79920000000000L, 61818L, 80006400000000L, 61885L, 80092800000000L, 61952L, 80179200000000L, 62019L, 80265600000000L, 62086L, 80352000000000L, 62153L, 80438400000000L, 62220L, 80524800000000L, 62287L, 80611200000000L, 62354L, 80697600000000L, 62421L, 80784000000000L, 62489L, 80870400000000L, 62556L, 80956800000000L, 62625L, 81043200000000L, 62692L, 81129600000000L, 62759L, 81216000000000L, 62826L, 81302400000000L, 62893L, 81388800000000L, 62960L, 81475200000000L, 63027L, 81561600000000L, 63094L, 81648000000000L, 63161L, 81734400000000L, 63228L, 81820800000000L, 63295L, 81907200000000L, 63362L, 81993600000000L, 63429L, 82080000000000L, 63496L, 82166400000000L, 63563L, 82252800000000L, 63630L, 82339200000000L, 63699L, 82425600000000L, 63766L, 82512000000000L, 63833L, 82598400000000L, 63900L, 82684800000000L, 63967L, 82771200000000L, 64034L, 82857600000000L, 64101L, 82944000000000L, 64168L, 83030400000000L, 64236L, 83116800000000L, 64303L, 83203200000000L, 64371L, 83289600000000L, 64438L, 83376000000000L, 64505L, 83462400000000L, 64572L, 83548800000000L, 64639L, 83635200000000L, 64706L, 83721600000000L, 64774L, 83808000000000L, 64841L, 83894400000000L, 64908L, 83980800000000L, 64975L, 84067200000000L, 65042L, 84153600000000L, 65109L, 84240000000000L, 65176L, 84326400000000L, 65244L, 84412800000000L, 65311L, 84499200000000L, 65378L, 84585600000000L, 65445L, 84672000000000L, 65512L, 84758400000000L, 65579L, 84844800000000L, 65646L, 84931200000000L, 65714L, 85017600000000L, 65781L, 85104000000000L, 65848L, 85190400000000L, 65915L, 85276800000000L, 65982L, 85363200000000L, 66049L, 85449600000000L, 66116L, 85536000000000L, 66183L, 85622400000000L, 66250L, 85708800000000L, 66317L, 85795200000000L, 66384L, 85881600000000L, 66452L, 85968000000000L, 66519L, 86054400000000L, 66586L, 86140800000000L, 66653L, 86227200000000L, 66720L, 86313600000000L, 66787L, 86400000000000L, 66854)
        );
    }

    @Test
    public void test() throws NumericException {
        String[] inputs = new String[]{
                "31", "1970-01-02T00:00:00.000000Z", "94", "1970-01-03T00:00:00.000000Z", "157", "1970-01-04T00:00:00.000000Z", "220", "1970-01-05T00:00:00.000000Z", "283", "1970-01-06T00:00:00.000000Z", "346", "1970-01-07T00:00:00.000000Z", "409", "1970-01-08T00:00:00.000000Z", "472", "1970-01-09T00:00:00.000000Z", "535", "1970-01-10T00:00:00.000000Z", "598", "1970-01-11T00:00:00.000000Z", "663", "1970-01-12T00:00:00.000000Z", "728", "1970-01-13T00:00:00.000000Z", "794", "1970-01-14T00:00:00.000000Z", "859", "1970-01-15T00:00:00.000000Z", "924", "1970-01-16T00:00:00.000000Z", "989", "1970-01-17T00:00:00.000000Z", "1054", "1970-01-18T00:00:00.000000Z", "1119", "1970-01-19T00:00:00.000000Z", "1184", "1970-01-20T00:00:00.000000Z", "1249", "1970-01-21T00:00:00.000000Z", "1315", "1970-01-22T00:00:00.000000Z", "1380", "1970-01-23T00:00:00.000000Z", "1445", "1970-01-24T00:00:00.000000Z", "1510", "1970-01-25T00:00:00.000000Z", "1575", "1970-01-26T00:00:00.000000Z", "1640", "1970-01-27T00:00:00.000000Z", "1705", "1970-01-28T00:00:00.000000Z", "1771", "1970-01-29T00:00:00.000000Z", "1836", "1970-01-30T00:00:00.000000Z", "1902", "1970-01-31T00:00:00.000000Z", "1972", "1970-02-01T00:00:00.000000Z", "2037", "1970-02-02T00:00:00.000000Z", "2102", "1970-02-03T00:00:00.000000Z", "2168", "1970-02-04T00:00:00.000000Z", "2233", "1970-02-05T00:00:00.000000Z", "2298", "1970-02-06T00:00:00.000000Z", "2363", "1970-02-07T00:00:00.000000Z", "2428", "1970-02-08T00:00:00.000000Z", "2493", "1970-02-09T00:00:00.000000Z", "2558", "1970-02-10T00:00:00.000000Z", "2623", "1970-02-11T00:00:00.000000Z", "2688", "1970-02-12T00:00:00.000000Z", "2753", "1970-02-13T00:00:00.000000Z", "2818", "1970-02-14T00:00:00.000000Z", "2883", "1970-02-15T00:00:00.000000Z", "2948", "1970-02-16T00:00:00.000000Z", "3013", "1970-02-17T00:00:00.000000Z", "3078", "1970-02-18T00:00:00.000000Z", "3143", "1970-02-19T00:00:00.000000Z", "3208", "1970-02-20T00:00:00.000000Z", "3274", "1970-02-21T00:00:00.000000Z", "3339", "1970-02-22T00:00:00.000000Z", "3404", "1970-02-23T00:00:00.000000Z", "3469", "1970-02-24T00:00:00.000000Z", "3534", "1970-02-25T00:00:00.000000Z", "3599", "1970-02-26T00:00:00.000000Z", "3664", "1970-02-27T00:00:00.000000Z", "3729", "1970-02-28T00:00:00.000000Z", "3794", "1970-03-01T00:00:00.000000Z", "3860", "1970-03-02T00:00:00.000000Z", "3925", "1970-03-03T00:00:00.000000Z", "3990", "1970-03-04T00:00:00.000000Z", "4055", "1970-03-05T00:00:00.000000Z", "4120", "1970-03-06T00:00:00.000000Z", "4185", "1970-03-07T00:00:00.000000Z", "4250", "1970-03-08T00:00:00.000000Z", "4315", "1970-03-09T00:00:00.000000Z", "4380", "1970-03-10T00:00:00.000000Z", "4445", "1970-03-11T00:00:00.000000Z", "4510", "1970-03-12T00:00:00.000000Z", "4575", "1970-03-13T00:00:00.000000Z", "4640", "1970-03-14T00:00:00.000000Z", "4705", "1970-03-15T00:00:00.000000Z", "4770", "1970-03-16T00:00:00.000000Z", "4835", "1970-03-17T00:00:00.000000Z", "4900", "1970-03-18T00:00:00.000000Z", "4965", "1970-03-19T00:00:00.000000Z", "5031", "1970-03-20T00:00:00.000000Z", "5096", "1970-03-21T00:00:00.000000Z", "5161", "1970-03-22T00:00:00.000000Z", "5226", "1970-03-23T00:00:00.000000Z", "5291", "1970-03-24T00:00:00.000000Z", "5356", "1970-03-25T00:00:00.000000Z", "5421", "1970-03-26T00:00:00.000000Z", "5486", "1970-03-27T00:00:00.000000Z", "5551", "1970-03-28T00:00:00.000000Z", "5616", "1970-03-29T00:00:00.000000Z", "5681", "1970-03-30T00:00:00.000000Z", "5746", "1970-03-31T00:00:00.000000Z", "5811", "1970-04-01T00:00:00.000000Z", "5876", "1970-04-02T00:00:00.000000Z", "5941", "1970-04-03T00:00:00.000000Z", "6006", "1970-04-04T00:00:00.000000Z", "6071", "1970-04-05T00:00:00.000000Z", "6136", "1970-04-06T00:00:00.000000Z", "6201", "1970-04-07T00:00:00.000000Z", "6266", "1970-04-08T00:00:00.000000Z", "6331", "1970-04-09T00:00:00.000000Z", "6396", "1970-04-10T00:00:00.000000Z", "6461", "1970-04-11T00:00:00.000000Z", "6528", "1970-04-12T00:00:00.000000Z", "6595", "1970-04-13T00:00:00.000000Z", "6662", "1970-04-14T00:00:00.000000Z", "6729", "1970-04-15T00:00:00.000000Z", "6796", "1970-04-16T00:00:00.000000Z", "6863", "1970-04-17T00:00:00.000000Z", "6930", "1970-04-18T00:00:00.000000Z", "6997", "1970-04-19T00:00:00.000000Z", "7064", "1970-04-20T00:00:00.000000Z", "7131", "1970-04-21T00:00:00.000000Z", "7198", "1970-04-22T00:00:00.000000Z", "7265", "1970-04-23T00:00:00.000000Z", "7332", "1970-04-24T00:00:00.000000Z", "7399", "1970-04-25T00:00:00.000000Z", "7466", "1970-04-26T00:00:00.000000Z", "7534", "1970-04-27T00:00:00.000000Z", "7601", "1970-04-28T00:00:00.000000Z", "7668", "1970-04-29T00:00:00.000000Z", "7735", "1970-04-30T00:00:00.000000Z", "7802", "1970-05-01T00:00:00.000000Z", "7869", "1970-05-02T00:00:00.000000Z", "7936", "1970-05-03T00:00:00.000000Z", "8003", "1970-05-04T00:00:00.000000Z", "8070", "1970-05-05T00:00:00.000000Z", "8137", "1970-05-06T00:00:00.000000Z", "8204", "1970-05-07T00:00:00.000000Z", "8271", "1970-05-08T00:00:00.000000Z", "8339", "1970-05-09T00:00:00.000000Z", "8406", "1970-05-10T00:00:00.000000Z", "8473", "1970-05-11T00:00:00.000000Z", "8540", "1970-05-12T00:00:00.000000Z", "8607", "1970-05-13T00:00:00.000000Z", "8674", "1970-05-14T00:00:00.000000Z", "8741", "1970-05-15T00:00:00.000000Z", "8808", "1970-05-16T00:00:00.000000Z", "8875", "1970-05-17T00:00:00.000000Z", "8942", "1970-05-18T00:00:00.000000Z", "9009", "1970-05-19T00:00:00.000000Z", "9076", "1970-05-20T00:00:00.000000Z", "9143", "1970-05-21T00:00:00.000000Z", "9210", "1970-05-22T00:00:00.000000Z", "9278", "1970-05-23T00:00:00.000000Z", "9345", "1970-05-24T00:00:00.000000Z", "9412", "1970-05-25T00:00:00.000000Z", "9480", "1970-05-26T00:00:00.000000Z", "9547", "1970-05-27T00:00:00.000000Z", "9614", "1970-05-28T00:00:00.000000Z", "9681", "1970-05-29T00:00:00.000000Z", "9748", "1970-05-30T00:00:00.000000Z", "9815", "1970-05-31T00:00:00.000000Z", "9882", "1970-06-01T00:00:00.000000Z", "9949", "1970-06-02T00:00:00.000000Z", "10017", "1970-06-03T00:00:00.000000Z", "10084", "1970-06-04T00:00:00.000000Z", "10151", "1970-06-05T00:00:00.000000Z", "10218", "1970-06-06T00:00:00.000000Z", "10287", "1970-06-07T00:00:00.000000Z", "10354", "1970-06-08T00:00:00.000000Z", "10421", "1970-06-09T00:00:00.000000Z", "10488", "1970-06-10T00:00:00.000000Z", "10555", "1970-06-11T00:00:00.000000Z", "10622", "1970-06-12T00:00:00.000000Z", "10689", "1970-06-13T00:00:00.000000Z", "10756", "1970-06-14T00:00:00.000000Z", "10823", "1970-06-15T00:00:00.000000Z", "10890", "1970-06-16T00:00:00.000000Z", "10957", "1970-06-17T00:00:00.000000Z", "11024", "1970-06-18T00:00:00.000000Z", "11091", "1970-06-19T00:00:00.000000Z", "11158", "1970-06-20T00:00:00.000000Z", "11226", "1970-06-21T00:00:00.000000Z", "11293", "1970-06-22T00:00:00.000000Z", "11360", "1970-06-23T00:00:00.000000Z", "11427", "1970-06-24T00:00:00.000000Z", "11494", "1970-06-25T00:00:00.000000Z", "11561", "1970-06-26T00:00:00.000000Z", "11628", "1970-06-27T00:00:00.000000Z", "11695", "1970-06-28T00:00:00.000000Z", "11762", "1970-06-29T00:00:00.000000Z", "11829", "1970-06-30T00:00:00.000000Z", "11896", "1970-07-01T00:00:00.000000Z", "11963", "1970-07-02T00:00:00.000000Z", "12030", "1970-07-03T00:00:00.000000Z", "12097", "1970-07-04T00:00:00.000000Z", "12164", "1970-07-05T00:00:00.000000Z", "12231", "1970-07-06T00:00:00.000000Z", "12299", "1970-07-07T00:00:00.000000Z", "12366", "1970-07-08T00:00:00.000000Z", "12434", "1970-07-09T00:00:00.000000Z", "12501", "1970-07-10T00:00:00.000000Z", "12568", "1970-07-11T00:00:00.000000Z", "12635", "1970-07-12T00:00:00.000000Z", "12702", "1970-07-13T00:00:00.000000Z", "12769", "1970-07-14T00:00:00.000000Z", "12836", "1970-07-15T00:00:00.000000Z", "12903", "1970-07-16T00:00:00.000000Z", "12970", "1970-07-17T00:00:00.000000Z", "13037", "1970-07-18T00:00:00.000000Z", "13104", "1970-07-19T00:00:00.000000Z", "13172", "1970-07-20T00:00:00.000000Z", "13240", "1970-07-21T00:00:00.000000Z", "13307", "1970-07-22T00:00:00.000000Z", "13374", "1970-07-23T00:00:00.000000Z", "13441", "1970-07-24T00:00:00.000000Z", "13508", "1970-07-25T00:00:00.000000Z", "13575", "1970-07-26T00:00:00.000000Z", "13642", "1970-07-27T00:00:00.000000Z", "13710", "1970-07-28T00:00:00.000000Z", "13777", "1970-07-29T00:00:00.000000Z", "13844", "1970-07-30T00:00:00.000000Z", "13911", "1970-07-31T00:00:00.000000Z", "13978", "1970-08-01T00:00:00.000000Z", "14045", "1970-08-02T00:00:00.000000Z", "14112", "1970-08-03T00:00:00.000000Z", "14179", "1970-08-04T00:00:00.000000Z", "14246", "1970-08-05T00:00:00.000000Z", "14313", "1970-08-06T00:00:00.000000Z", "14380", "1970-08-07T00:00:00.000000Z", "14447", "1970-08-08T00:00:00.000000Z", "14514", "1970-08-09T00:00:00.000000Z", "14581", "1970-08-10T00:00:00.000000Z", "14649", "1970-08-11T00:00:00.000000Z", "14716", "1970-08-12T00:00:00.000000Z", "14783", "1970-08-13T00:00:00.000000Z", "14851", "1970-08-14T00:00:00.000000Z", "14918", "1970-08-15T00:00:00.000000Z", "14985", "1970-08-16T00:00:00.000000Z", "15052", "1970-08-17T00:00:00.000000Z", "15120", "1970-08-18T00:00:00.000000Z", "15187", "1970-08-19T00:00:00.000000Z", "15254", "1970-08-20T00:00:00.000000Z", "15321", "1970-08-21T00:00:00.000000Z", "15388", "1970-08-22T00:00:00.000000Z", "15455", "1970-08-23T00:00:00.000000Z", "15523", "1970-08-24T00:00:00.000000Z", "15590", "1970-08-25T00:00:00.000000Z", "15657", "1970-08-26T00:00:00.000000Z", "15725", "1970-08-27T00:00:00.000000Z", "15792", "1970-08-28T00:00:00.000000Z", "15859", "1970-08-29T00:00:00.000000Z", "15926", "1970-08-30T00:00:00.000000Z", "15993", "1970-08-31T00:00:00.000000Z", "16060", "1970-09-01T00:00:00.000000Z", "16127", "1970-09-02T00:00:00.000000Z", "16194", "1970-09-03T00:00:00.000000Z", "16261", "1970-09-04T00:00:00.000000Z", "16328", "1970-09-05T00:00:00.000000Z", "16395", "1970-09-06T00:00:00.000000Z", "16462", "1970-09-07T00:00:00.000000Z", "16529", "1970-09-08T00:00:00.000000Z", "16596", "1970-09-09T00:00:00.000000Z", "16663", "1970-09-10T00:00:00.000000Z", "16730", "1970-09-11T00:00:00.000000Z", "16797", "1970-09-12T00:00:00.000000Z", "16864", "1970-09-13T00:00:00.000000Z", "16931", "1970-09-14T00:00:00.000000Z", "16999", "1970-09-15T00:00:00.000000Z", "17066", "1970-09-16T00:00:00.000000Z", "17133", "1970-09-17T00:00:00.000000Z", "17200", "1970-09-18T00:00:00.000000Z", "17267", "1970-09-19T00:00:00.000000Z", "17334", "1970-09-20T00:00:00.000000Z", "17401", "1970-09-21T00:00:00.000000Z", "17468", "1970-09-22T00:00:00.000000Z", "17535", "1970-09-23T00:00:00.000000Z", "17602", "1970-09-24T00:00:00.000000Z", "17669", "1970-09-25T00:00:00.000000Z", "17736", "1970-09-26T00:00:00.000000Z", "17803", "1970-09-27T00:00:00.000000Z", "17870", "1970-09-28T00:00:00.000000Z", "17937", "1970-09-29T00:00:00.000000Z", "18004", "1970-09-30T00:00:00.000000Z", "18071", "1970-10-01T00:00:00.000000Z", "18138", "1970-10-02T00:00:00.000000Z", "18207", "1970-10-03T00:00:00.000000Z", "18274", "1970-10-04T00:00:00.000000Z", "18341", "1970-10-05T00:00:00.000000Z", "18408", "1970-10-06T00:00:00.000000Z", "18475", "1970-10-07T00:00:00.000000Z", "18542", "1970-10-08T00:00:00.000000Z", "18609", "1970-10-09T00:00:00.000000Z", "18676", "1970-10-10T00:00:00.000000Z", "18743", "1970-10-11T00:00:00.000000Z", "18810", "1970-10-12T00:00:00.000000Z", "18878", "1970-10-13T00:00:00.000000Z", "18945", "1970-10-14T00:00:00.000000Z", "19012", "1970-10-15T00:00:00.000000Z", "19079", "1970-10-16T00:00:00.000000Z", "19146", "1970-10-17T00:00:00.000000Z", "19213", "1970-10-18T00:00:00.000000Z", "19280", "1970-10-19T00:00:00.000000Z", "19347", "1970-10-20T00:00:00.000000Z", "19414", "1970-10-21T00:00:00.000000Z", "19481", "1970-10-22T00:00:00.000000Z", "19548", "1970-10-23T00:00:00.000000Z", "19615", "1970-10-24T00:00:00.000000Z", "19682", "1970-10-25T00:00:00.000000Z", "19749", "1970-10-26T00:00:00.000000Z", "19816", "1970-10-27T00:00:00.000000Z", "19883", "1970-10-28T00:00:00.000000Z", "19950", "1970-10-29T00:00:00.000000Z", "20017", "1970-10-30T00:00:00.000000Z", "20084", "1970-10-31T00:00:00.000000Z", "20151", "1970-11-01T00:00:00.000000Z", "20218", "1970-11-02T00:00:00.000000Z", "20285", "1970-11-03T00:00:00.000000Z", "20352", "1970-11-04T00:00:00.000000Z", "20420", "1970-11-05T00:00:00.000000Z", "20487", "1970-11-06T00:00:00.000000Z", "20554", "1970-11-07T00:00:00.000000Z", "20621", "1970-11-08T00:00:00.000000Z", "20688", "1970-11-09T00:00:00.000000Z", "20755", "1970-11-10T00:00:00.000000Z", "20822", "1970-11-11T00:00:00.000000Z", "20889", "1970-11-12T00:00:00.000000Z", "20956", "1970-11-13T00:00:00.000000Z", "21023", "1970-11-14T00:00:00.000000Z", "21090", "1970-11-15T00:00:00.000000Z", "21157", "1970-11-16T00:00:00.000000Z", "21224", "1970-11-17T00:00:00.000000Z", "21291", "1970-11-18T00:00:00.000000Z", "21358", "1970-11-19T00:00:00.000000Z", "21426", "1970-11-20T00:00:00.000000Z", "21493", "1970-11-21T00:00:00.000000Z", "21560", "1970-11-22T00:00:00.000000Z", "21629", "1970-11-23T00:00:00.000000Z", "21696", "1970-11-24T00:00:00.000000Z", "21763", "1970-11-25T00:00:00.000000Z", "21830", "1970-11-26T00:00:00.000000Z", "21897", "1970-11-27T00:00:00.000000Z", "21964", "1970-11-28T00:00:00.000000Z", "22031", "1970-11-29T00:00:00.000000Z", "22100", "1970-11-30T00:00:00.000000Z", "22167", "1970-12-01T00:00:00.000000Z", "22234", "1970-12-02T00:00:00.000000Z", "22301", "1970-12-03T00:00:00.000000Z", "22368", "1970-12-04T00:00:00.000000Z", "22435", "1970-12-05T00:00:00.000000Z", "22502", "1970-12-06T00:00:00.000000Z", "22569", "1970-12-07T00:00:00.000000Z", "22636", "1970-12-08T00:00:00.000000Z", "22703", "1970-12-09T00:00:00.000000Z", "22770", "1970-12-10T00:00:00.000000Z", "22837", "1970-12-11T00:00:00.000000Z", "22904", "1970-12-12T00:00:00.000000Z", "22971", "1970-12-13T00:00:00.000000Z", "23038", "1970-12-14T00:00:00.000000Z", "23105", "1970-12-15T00:00:00.000000Z", "23172", "1970-12-16T00:00:00.000000Z", "23240", "1970-12-17T00:00:00.000000Z", "23307", "1970-12-18T00:00:00.000000Z", "23374", "1970-12-19T00:00:00.000000Z", "23441", "1970-12-20T00:00:00.000000Z", "23508", "1970-12-21T00:00:00.000000Z", "23575", "1970-12-22T00:00:00.000000Z", "23643", "1970-12-23T00:00:00.000000Z", "23711", "1970-12-24T00:00:00.000000Z", "23778", "1970-12-25T00:00:00.000000Z", "23845", "1970-12-26T00:00:00.000000Z", "23913", "1970-12-27T00:00:00.000000Z", "23980", "1970-12-28T00:00:00.000000Z", "24047", "1970-12-29T00:00:00.000000Z", "24115", "1970-12-30T00:00:00.000000Z", "24182", "1970-12-31T00:00:00.000000Z", "24249", "1971-01-01T00:00:00.000000Z", "24316", "1971-01-02T00:00:00.000000Z", "24383", "1971-01-03T00:00:00.000000Z", "24450", "1971-01-04T00:00:00.000000Z", "24517", "1971-01-05T00:00:00.000000Z", "24584", "1971-01-06T00:00:00.000000Z", "24651", "1971-01-07T00:00:00.000000Z", "24718", "1971-01-08T00:00:00.000000Z", "24786", "1971-01-09T00:00:00.000000Z", "24853", "1971-01-10T00:00:00.000000Z", "24920", "1971-01-11T00:00:00.000000Z", "24987", "1971-01-12T00:00:00.000000Z", "25054", "1971-01-13T00:00:00.000000Z", "25122", "1971-01-14T00:00:00.000000Z", "25189", "1971-01-15T00:00:00.000000Z", "25256", "1971-01-16T00:00:00.000000Z", "25323", "1971-01-17T00:00:00.000000Z", "25390", "1971-01-18T00:00:00.000000Z", "25457", "1971-01-19T00:00:00.000000Z", "25524", "1971-01-20T00:00:00.000000Z", "25591", "1971-01-21T00:00:00.000000Z", "25658", "1971-01-22T00:00:00.000000Z", "25725", "1971-01-23T00:00:00.000000Z", "25792", "1971-01-24T00:00:00.000000Z", "25859", "1971-01-25T00:00:00.000000Z", "25927", "1971-01-26T00:00:00.000000Z", "25994", "1971-01-27T00:00:00.000000Z", "26062", "1971-01-28T00:00:00.000000Z", "26129", "1971-01-29T00:00:00.000000Z", "26196", "1971-01-30T00:00:00.000000Z", "26263", "1971-01-31T00:00:00.000000Z", "26330", "1971-02-01T00:00:00.000000Z", "26397", "1971-02-02T00:00:00.000000Z", "26464", "1971-02-03T00:00:00.000000Z", "26531", "1971-02-04T00:00:00.000000Z", "26598", "1971-02-05T00:00:00.000000Z", "26665", "1971-02-06T00:00:00.000000Z", "26733", "1971-02-07T00:00:00.000000Z", "26800", "1971-02-08T00:00:00.000000Z", "26867", "1971-02-09T00:00:00.000000Z", "26934", "1971-02-10T00:00:00.000000Z", "27001", "1971-02-11T00:00:00.000000Z", "27069", "1971-02-12T00:00:00.000000Z", "27136", "1971-02-13T00:00:00.000000Z", "27203", "1971-02-14T00:00:00.000000Z", "27270", "1971-02-15T00:00:00.000000Z", "27337", "1971-02-16T00:00:00.000000Z", "27405", "1971-02-17T00:00:00.000000Z", "27472", "1971-02-18T00:00:00.000000Z", "27539", "1971-02-19T00:00:00.000000Z", "27607", "1971-02-20T00:00:00.000000Z", "27674", "1971-02-21T00:00:00.000000Z", "27741", "1971-02-22T00:00:00.000000Z", "27808", "1971-02-23T00:00:00.000000Z", "27875", "1971-02-24T00:00:00.000000Z", "27942", "1971-02-25T00:00:00.000000Z", "28009", "1971-02-26T00:00:00.000000Z", "28076", "1971-02-27T00:00:00.000000Z", "28143", "1971-02-28T00:00:00.000000Z", "28210", "1971-03-01T00:00:00.000000Z", "28278", "1971-03-02T00:00:00.000000Z", "28347", "1971-03-03T00:00:00.000000Z", "28414", "1971-03-04T00:00:00.000000Z", "28482", "1971-03-05T00:00:00.000000Z", "28549", "1971-03-06T00:00:00.000000Z", "28616", "1971-03-07T00:00:00.000000Z", "28683", "1971-03-08T00:00:00.000000Z", "28750", "1971-03-09T00:00:00.000000Z", "28817", "1971-03-10T00:00:00.000000Z", "28884", "1971-03-11T00:00:00.000000Z", "28951", "1971-03-12T00:00:00.000000Z", "29018", "1971-03-13T00:00:00.000000Z", "29085", "1971-03-14T00:00:00.000000Z", "29152", "1971-03-15T00:00:00.000000Z", "29219", "1971-03-16T00:00:00.000000Z", "29286", "1971-03-17T00:00:00.000000Z", "29353", "1971-03-18T00:00:00.000000Z", "29421", "1971-03-19T00:00:00.000000Z", "29488", "1971-03-20T00:00:00.000000Z", "29555", "1971-03-21T00:00:00.000000Z", "29622", "1971-03-22T00:00:00.000000Z", "29690", "1971-03-23T00:00:00.000000Z", "29758", "1971-03-24T00:00:00.000000Z", "29825", "1971-03-25T00:00:00.000000Z", "29892", "1971-03-26T00:00:00.000000Z", "29959", "1971-03-27T00:00:00.000000Z", "30026", "1971-03-28T00:00:00.000000Z", "30093", "1971-03-29T00:00:00.000000Z", "30160", "1971-03-30T00:00:00.000000Z", "30229", "1971-03-31T00:00:00.000000Z", "30296", "1971-04-01T00:00:00.000000Z", "30363", "1971-04-02T00:00:00.000000Z", "30430", "1971-04-03T00:00:00.000000Z", "30497", "1971-04-04T00:00:00.000000Z", "30564", "1971-04-05T00:00:00.000000Z", "30631", "1971-04-06T00:00:00.000000Z", "30698", "1971-04-07T00:00:00.000000Z", "30765", "1971-04-08T00:00:00.000000Z", "30832", "1971-04-09T00:00:00.000000Z", "30899", "1971-04-10T00:00:00.000000Z", "30966", "1971-04-11T00:00:00.000000Z", "31033", "1971-04-12T00:00:00.000000Z", "31100", "1971-04-13T00:00:00.000000Z", "31167", "1971-04-14T00:00:00.000000Z", "31234", "1971-04-15T00:00:00.000000Z", "31301", "1971-04-16T00:00:00.000000Z", "31368", "1971-04-17T00:00:00.000000Z", "31435", "1971-04-18T00:00:00.000000Z", "31502", "1971-04-19T00:00:00.000000Z", "31569", "1971-04-20T00:00:00.000000Z", "31636", "1971-04-21T00:00:00.000000Z", "31703", "1971-04-22T00:00:00.000000Z", "31770", "1971-04-23T00:00:00.000000Z", "31838", "1971-04-24T00:00:00.000000Z", "31905", "1971-04-25T00:00:00.000000Z", "31972", "1971-04-26T00:00:00.000000Z", "32039", "1971-04-27T00:00:00.000000Z", "32106", "1971-04-28T00:00:00.000000Z", "32173", "1971-04-29T00:00:00.000000Z", "32240", "1971-04-30T00:00:00.000000Z", "32307", "1971-05-01T00:00:00.000000Z", "32374", "1971-05-02T00:00:00.000000Z", "32441", "1971-05-03T00:00:00.000000Z", "32508", "1971-05-04T00:00:00.000000Z", "32575", "1971-05-05T00:00:00.000000Z", "32643", "1971-05-06T00:00:00.000000Z", "32710", "1971-05-07T00:00:00.000000Z", "32777", "1971-05-08T00:00:00.000000Z", "32844", "1971-05-09T00:00:00.000000Z", "32911", "1971-05-10T00:00:00.000000Z", "32978", "1971-05-11T00:00:00.000000Z", "33045", "1971-05-12T00:00:00.000000Z", "33112", "1971-05-13T00:00:00.000000Z", "33179", "1971-05-14T00:00:00.000000Z", "33246", "1971-05-15T00:00:00.000000Z", "33313", "1971-05-16T00:00:00.000000Z", "33380", "1971-05-17T00:00:00.000000Z", "33447", "1971-05-18T00:00:00.000000Z", "33514", "1971-05-19T00:00:00.000000Z", "33581", "1971-05-20T00:00:00.000000Z", "33648", "1971-05-21T00:00:00.000000Z", "33715", "1971-05-22T00:00:00.000000Z", "33782", "1971-05-23T00:00:00.000000Z", "33849", "1971-05-24T00:00:00.000000Z", "33916", "1971-05-25T00:00:00.000000Z", "33983", "1971-05-26T00:00:00.000000Z", "34050", "1971-05-27T00:00:00.000000Z", "34117", "1971-05-28T00:00:00.000000Z", "34184", "1971-05-29T00:00:00.000000Z", "34251", "1971-05-30T00:00:00.000000Z", "34318", "1971-05-31T00:00:00.000000Z", "34385", "1971-06-01T00:00:00.000000Z", "34452", "1971-06-02T00:00:00.000000Z", "34519", "1971-06-03T00:00:00.000000Z", "34586", "1971-06-04T00:00:00.000000Z", "34653", "1971-06-05T00:00:00.000000Z", "34720", "1971-06-06T00:00:00.000000Z", "34787", "1971-06-07T00:00:00.000000Z", "34854", "1971-06-08T00:00:00.000000Z", "34921", "1971-06-09T00:00:00.000000Z", "34989", "1971-06-10T00:00:00.000000Z", "35056", "1971-06-11T00:00:00.000000Z", "35123", "1971-06-12T00:00:00.000000Z", "35190", "1971-06-13T00:00:00.000000Z", "35257", "1971-06-14T00:00:00.000000Z", "35324", "1971-06-15T00:00:00.000000Z", "35391", "1971-06-16T00:00:00.000000Z", "35458", "1971-06-17T00:00:00.000000Z", "35525", "1971-06-18T00:00:00.000000Z", "35592", "1971-06-19T00:00:00.000000Z", "35659", "1971-06-20T00:00:00.000000Z", "35726", "1971-06-21T00:00:00.000000Z", "35793", "1971-06-22T00:00:00.000000Z", "35860", "1971-06-23T00:00:00.000000Z", "35928", "1971-06-24T00:00:00.000000Z", "35995", "1971-06-25T00:00:00.000000Z", "36062", "1971-06-26T00:00:00.000000Z", "36129", "1971-06-27T00:00:00.000000Z", "36196", "1971-06-28T00:00:00.000000Z", "36263", "1971-06-29T00:00:00.000000Z", "36330", "1971-06-30T00:00:00.000000Z", "36397", "1971-07-01T00:00:00.000000Z", "36464", "1971-07-02T00:00:00.000000Z", "36531", "1971-07-03T00:00:00.000000Z", "36599", "1971-07-04T00:00:00.000000Z", "36666", "1971-07-05T00:00:00.000000Z", "36733", "1971-07-06T00:00:00.000000Z", "36801", "1971-07-07T00:00:00.000000Z", "36868", "1971-07-08T00:00:00.000000Z", "36935", "1971-07-09T00:00:00.000000Z", "37002", "1971-07-10T00:00:00.000000Z", "37069", "1971-07-11T00:00:00.000000Z", "37137", "1971-07-12T00:00:00.000000Z", "37205", "1971-07-13T00:00:00.000000Z", "37272", "1971-07-14T00:00:00.000000Z", "37339", "1971-07-15T00:00:00.000000Z", "37406", "1971-07-16T00:00:00.000000Z", "37473", "1971-07-17T00:00:00.000000Z", "37540", "1971-07-18T00:00:00.000000Z", "37607", "1971-07-19T00:00:00.000000Z", "37674", "1971-07-20T00:00:00.000000Z", "37741", "1971-07-21T00:00:00.000000Z", "37808", "1971-07-22T00:00:00.000000Z", "37875", "1971-07-23T00:00:00.000000Z", "37942", "1971-07-24T00:00:00.000000Z", "38009", "1971-07-25T00:00:00.000000Z", "38076", "1971-07-26T00:00:00.000000Z", "38143", "1971-07-27T00:00:00.000000Z", "38210", "1971-07-28T00:00:00.000000Z", "38277", "1971-07-29T00:00:00.000000Z", "38344", "1971-07-30T00:00:00.000000Z", "38411", "1971-07-31T00:00:00.000000Z", "38478", "1971-08-01T00:00:00.000000Z", "38545", "1971-08-02T00:00:00.000000Z", "38613", "1971-08-03T00:00:00.000000Z", "38680", "1971-08-04T00:00:00.000000Z", "38747", "1971-08-05T00:00:00.000000Z", "38814", "1971-08-06T00:00:00.000000Z", "38881", "1971-08-07T00:00:00.000000Z", "38948", "1971-08-08T00:00:00.000000Z", "39016", "1971-08-09T00:00:00.000000Z", "39083", "1971-08-10T00:00:00.000000Z", "39150", "1971-08-11T00:00:00.000000Z", "39217", "1971-08-12T00:00:00.000000Z", "39284", "1971-08-13T00:00:00.000000Z", "39351", "1971-08-14T00:00:00.000000Z", "39418", "1971-08-15T00:00:00.000000Z", "39485", "1971-08-16T00:00:00.000000Z", "39552", "1971-08-17T00:00:00.000000Z", "39619", "1971-08-18T00:00:00.000000Z", "39687", "1971-08-19T00:00:00.000000Z", "39754", "1971-08-20T00:00:00.000000Z", "39821", "1971-08-21T00:00:00.000000Z", "39888", "1971-08-22T00:00:00.000000Z", "39956", "1971-08-23T00:00:00.000000Z", "40023", "1971-08-24T00:00:00.000000Z", "40090", "1971-08-25T00:00:00.000000Z", "40157", "1971-08-26T00:00:00.000000Z", "40224", "1971-08-27T00:00:00.000000Z", "40291", "1971-08-28T00:00:00.000000Z", "40358", "1971-08-29T00:00:00.000000Z", "40425", "1971-08-30T00:00:00.000000Z", "40492", "1971-08-31T00:00:00.000000Z", "40559", "1971-09-01T00:00:00.000000Z", "40626", "1971-09-02T00:00:00.000000Z", "40693", "1971-09-03T00:00:00.000000Z", "40760", "1971-09-04T00:00:00.000000Z", "40827", "1971-09-05T00:00:00.000000Z", "40894", "1971-09-06T00:00:00.000000Z", "40962", "1971-09-07T00:00:00.000000Z", "41029", "1971-09-08T00:00:00.000000Z", "41096", "1971-09-09T00:00:00.000000Z", "41163", "1971-09-10T00:00:00.000000Z", "41230", "1971-09-11T00:00:00.000000Z", "41297", "1971-09-12T00:00:00.000000Z", "41364", "1971-09-13T00:00:00.000000Z", "41431", "1971-09-14T00:00:00.000000Z", "41498", "1971-09-15T00:00:00.000000Z", "41565", "1971-09-16T00:00:00.000000Z", "41632", "1971-09-17T00:00:00.000000Z", "41699", "1971-09-18T00:00:00.000000Z", "41767", "1971-09-19T00:00:00.000000Z", "41834", "1971-09-20T00:00:00.000000Z", "41901", "1971-09-21T00:00:00.000000Z", "41968", "1971-09-22T00:00:00.000000Z", "42035", "1971-09-23T00:00:00.000000Z", "42102", "1971-09-24T00:00:00.000000Z", "42169", "1971-09-25T00:00:00.000000Z", "42236", "1971-09-26T00:00:00.000000Z", "42303", "1971-09-27T00:00:00.000000Z", "42370", "1971-09-28T00:00:00.000000Z", "42437", "1971-09-29T00:00:00.000000Z", "42504", "1971-09-30T00:00:00.000000Z", "42571", "1971-10-01T00:00:00.000000Z", "42638", "1971-10-02T00:00:00.000000Z", "42705", "1971-10-03T00:00:00.000000Z", "42772", "1971-10-04T00:00:00.000000Z", "42839", "1971-10-05T00:00:00.000000Z", "42906", "1971-10-06T00:00:00.000000Z", "42973", "1971-10-07T00:00:00.000000Z", "43040", "1971-10-08T00:00:00.000000Z", "43107", "1971-10-09T00:00:00.000000Z", "43174", "1971-10-10T00:00:00.000000Z", "43241", "1971-10-11T00:00:00.000000Z", "43308", "1971-10-12T00:00:00.000000Z", "43375", "1971-10-13T00:00:00.000000Z", "43442", "1971-10-14T00:00:00.000000Z", "43509", "1971-10-15T00:00:00.000000Z", "43576", "1971-10-16T00:00:00.000000Z", "43643", "1971-10-17T00:00:00.000000Z", "43710", "1971-10-18T00:00:00.000000Z", "43777", "1971-10-19T00:00:00.000000Z", "43844", "1971-10-20T00:00:00.000000Z", "43911", "1971-10-21T00:00:00.000000Z", "43978", "1971-10-22T00:00:00.000000Z", "44046", "1971-10-23T00:00:00.000000Z", "44113", "1971-10-24T00:00:00.000000Z", "44180", "1971-10-25T00:00:00.000000Z", "44247", "1971-10-26T00:00:00.000000Z", "44314", "1971-10-27T00:00:00.000000Z", "44381", "1971-10-28T00:00:00.000000Z", "44448", "1971-10-29T00:00:00.000000Z", "44516", "1971-10-30T00:00:00.000000Z", "44583", "1971-10-31T00:00:00.000000Z", "44650", "1971-11-01T00:00:00.000000Z", "44717", "1971-11-02T00:00:00.000000Z", "44784", "1971-11-03T00:00:00.000000Z", "44851", "1971-11-04T00:00:00.000000Z", "44918", "1971-11-05T00:00:00.000000Z", "44985", "1971-11-06T00:00:00.000000Z", "45052", "1971-11-07T00:00:00.000000Z", "45119", "1971-11-08T00:00:00.000000Z", "45186", "1971-11-09T00:00:00.000000Z", "45253", "1971-11-10T00:00:00.000000Z", "45320", "1971-11-11T00:00:00.000000Z", "45387", "1971-11-12T00:00:00.000000Z", "45454", "1971-11-13T00:00:00.000000Z", "45521", "1971-11-14T00:00:00.000000Z", "45588", "1971-11-15T00:00:00.000000Z", "45655", "1971-11-16T00:00:00.000000Z", "45722", "1971-11-17T00:00:00.000000Z", "45789", "1971-11-18T00:00:00.000000Z", "45856", "1971-11-19T00:00:00.000000Z", "45923", "1971-11-20T00:00:00.000000Z", "45990", "1971-11-21T00:00:00.000000Z", "46058", "1971-11-22T00:00:00.000000Z", "46125", "1971-11-23T00:00:00.000000Z", "46192", "1971-11-24T00:00:00.000000Z", "46259", "1971-11-25T00:00:00.000000Z", "46326", "1971-11-26T00:00:00.000000Z", "46393", "1971-11-27T00:00:00.000000Z", "46460", "1971-11-28T00:00:00.000000Z", "46527", "1971-11-29T00:00:00.000000Z", "46594", "1971-11-30T00:00:00.000000Z", "46661", "1971-12-01T00:00:00.000000Z", "46728", "1971-12-02T00:00:00.000000Z", "46795", "1971-12-03T00:00:00.000000Z", "46862", "1971-12-04T00:00:00.000000Z", "46929", "1971-12-05T00:00:00.000000Z", "46996", "1971-12-06T00:00:00.000000Z", "47063", "1971-12-07T00:00:00.000000Z", "47130", "1971-12-08T00:00:00.000000Z", "47197", "1971-12-09T00:00:00.000000Z", "47264", "1971-12-10T00:00:00.000000Z", "47331", "1971-12-11T00:00:00.000000Z", "47398", "1971-12-12T00:00:00.000000Z", "47465", "1971-12-13T00:00:00.000000Z", "47532", "1971-12-14T00:00:00.000000Z", "47599", "1971-12-15T00:00:00.000000Z", "47666", "1971-12-16T00:00:00.000000Z", "47733", "1971-12-17T00:00:00.000000Z", "47800", "1971-12-18T00:00:00.000000Z", "47867", "1971-12-19T00:00:00.000000Z", "47934", "1971-12-20T00:00:00.000000Z", "48001", "1971-12-21T00:00:00.000000Z", "48068", "1971-12-22T00:00:00.000000Z", "48135", "1971-12-23T00:00:00.000000Z", "48202", "1971-12-24T00:00:00.000000Z", "48269", "1971-12-25T00:00:00.000000Z", "48336", "1971-12-26T00:00:00.000000Z", "48403", "1971-12-27T00:00:00.000000Z", "48470", "1971-12-28T00:00:00.000000Z", "48537", "1971-12-29T00:00:00.000000Z", "48604", "1971-12-30T00:00:00.000000Z", "48671", "1971-12-31T00:00:00.000000Z", "48738", "1972-01-01T00:00:00.000000Z", "48806", "1972-01-02T00:00:00.000000Z", "48873", "1972-01-03T00:00:00.000000Z", "48940", "1972-01-04T00:00:00.000000Z", "49007", "1972-01-05T00:00:00.000000Z", "49074", "1972-01-06T00:00:00.000000Z", "49142", "1972-01-07T00:00:00.000000Z", "49209", "1972-01-08T00:00:00.000000Z", "49276", "1972-01-09T00:00:00.000000Z", "49344", "1972-01-10T00:00:00.000000Z", "49411", "1972-01-11T00:00:00.000000Z", "49478", "1972-01-12T00:00:00.000000Z", "49545", "1972-01-13T00:00:00.000000Z", "49612", "1972-01-14T00:00:00.000000Z", "49679", "1972-01-15T00:00:00.000000Z", "49746", "1972-01-16T00:00:00.000000Z", "49813", "1972-01-17T00:00:00.000000Z", "49881", "1972-01-18T00:00:00.000000Z", "49948", "1972-01-19T00:00:00.000000Z", "50015", "1972-01-20T00:00:00.000000Z", "50082", "1972-01-21T00:00:00.000000Z", "50149", "1972-01-22T00:00:00.000000Z", "50216", "1972-01-23T00:00:00.000000Z", "50283", "1972-01-24T00:00:00.000000Z", "50350", "1972-01-25T00:00:00.000000Z", "50417", "1972-01-26T00:00:00.000000Z", "50484", "1972-01-27T00:00:00.000000Z", "50551", "1972-01-28T00:00:00.000000Z", "50618", "1972-01-29T00:00:00.000000Z", "50685", "1972-01-30T00:00:00.000000Z", "50752", "1972-01-31T00:00:00.000000Z", "50819", "1972-02-01T00:00:00.000000Z", "50886", "1972-02-02T00:00:00.000000Z", "50953", "1972-02-03T00:00:00.000000Z", "51020", "1972-02-04T00:00:00.000000Z", "51087", "1972-02-05T00:00:00.000000Z", "51154", "1972-02-06T00:00:00.000000Z", "51221", "1972-02-07T00:00:00.000000Z", "51288", "1972-02-08T00:00:00.000000Z", "51355", "1972-02-09T00:00:00.000000Z", "51422", "1972-02-10T00:00:00.000000Z", "51489", "1972-02-11T00:00:00.000000Z", "51556", "1972-02-12T00:00:00.000000Z", "51623", "1972-02-13T00:00:00.000000Z", "51691", "1972-02-14T00:00:00.000000Z", "51758", "1972-02-15T00:00:00.000000Z", "51825", "1972-02-16T00:00:00.000000Z", "51892", "1972-02-17T00:00:00.000000Z", "51959", "1972-02-18T00:00:00.000000Z", "52026", "1972-02-19T00:00:00.000000Z", "52093", "1972-02-20T00:00:00.000000Z", "52160", "1972-02-21T00:00:00.000000Z", "52227", "1972-02-22T00:00:00.000000Z", "52294", "1972-02-23T00:00:00.000000Z", "52361", "1972-02-24T00:00:00.000000Z", "52429", "1972-02-25T00:00:00.000000Z", "52497", "1972-02-26T00:00:00.000000Z", "52564", "1972-02-27T00:00:00.000000Z", "52631", "1972-02-28T00:00:00.000000Z", "52698", "1972-02-29T00:00:00.000000Z", "52765", "1972-03-01T00:00:00.000000Z", "52832", "1972-03-02T00:00:00.000000Z", "52899", "1972-03-03T00:00:00.000000Z", "52966", "1972-03-04T00:00:00.000000Z", "53033", "1972-03-05T00:00:00.000000Z", "53100", "1972-03-06T00:00:00.000000Z", "53167", "1972-03-07T00:00:00.000000Z", "53234", "1972-03-08T00:00:00.000000Z", "53301", "1972-03-09T00:00:00.000000Z", "53368", "1972-03-10T00:00:00.000000Z", "53435", "1972-03-11T00:00:00.000000Z", "53502", "1972-03-12T00:00:00.000000Z", "53569", "1972-03-13T00:00:00.000000Z", "53636", "1972-03-14T00:00:00.000000Z", "53703", "1972-03-15T00:00:00.000000Z", "53770", "1972-03-16T00:00:00.000000Z", "53837", "1972-03-17T00:00:00.000000Z", "53904", "1972-03-18T00:00:00.000000Z", "53972", "1972-03-19T00:00:00.000000Z", "54039", "1972-03-20T00:00:00.000000Z", "54106", "1972-03-21T00:00:00.000000Z", "54173", "1972-03-22T00:00:00.000000Z", "54240", "1972-03-23T00:00:00.000000Z", "54307", "1972-03-24T00:00:00.000000Z", "54374", "1972-03-25T00:00:00.000000Z", "54441", "1972-03-26T00:00:00.000000Z", "54508", "1972-03-27T00:00:00.000000Z", "54575", "1972-03-28T00:00:00.000000Z", "54642", "1972-03-29T00:00:00.000000Z", "54709", "1972-03-30T00:00:00.000000Z", "54776", "1972-03-31T00:00:00.000000Z", "54843", "1972-04-01T00:00:00.000000Z", "54910", "1972-04-02T00:00:00.000000Z", "54977", "1972-04-03T00:00:00.000000Z", "55044", "1972-04-04T00:00:00.000000Z", "55111", "1972-04-05T00:00:00.000000Z", "55178", "1972-04-06T00:00:00.000000Z", "55246", "1972-04-07T00:00:00.000000Z", "55313", "1972-04-08T00:00:00.000000Z", "55380", "1972-04-09T00:00:00.000000Z", "55447", "1972-04-10T00:00:00.000000Z", "55514", "1972-04-11T00:00:00.000000Z", "55581", "1972-04-12T00:00:00.000000Z", "55648", "1972-04-13T00:00:00.000000Z", "55715", "1972-04-14T00:00:00.000000Z", "55782", "1972-04-15T00:00:00.000000Z", "55849", "1972-04-16T00:00:00.000000Z", "55916", "1972-04-17T00:00:00.000000Z", "55983", "1972-04-18T00:00:00.000000Z", "56050", "1972-04-19T00:00:00.000000Z", "56117", "1972-04-20T00:00:00.000000Z", "56184", "1972-04-21T00:00:00.000000Z", "56251", "1972-04-22T00:00:00.000000Z", "56318", "1972-04-23T00:00:00.000000Z", "56385", "1972-04-24T00:00:00.000000Z", "56452", "1972-04-25T00:00:00.000000Z", "56519", "1972-04-26T00:00:00.000000Z", "56586", "1972-04-27T00:00:00.000000Z", "56653", "1972-04-28T00:00:00.000000Z", "56720", "1972-04-29T00:00:00.000000Z", "56787", "1972-04-30T00:00:00.000000Z", "56854", "1972-05-01T00:00:00.000000Z", "56921", "1972-05-02T00:00:00.000000Z", "56988", "1972-05-03T00:00:00.000000Z", "57055", "1972-05-04T00:00:00.000000Z", "57122", "1972-05-05T00:00:00.000000Z", "57189", "1972-05-06T00:00:00.000000Z", "57256", "1972-05-07T00:00:00.000000Z", "57323", "1972-05-08T00:00:00.000000Z", "57390", "1972-05-09T00:00:00.000000Z", "57457", "1972-05-10T00:00:00.000000Z", "57524", "1972-05-11T00:00:00.000000Z", "57591", "1972-05-12T00:00:00.000000Z", "57658", "1972-05-13T00:00:00.000000Z", "57725", "1972-05-14T00:00:00.000000Z", "57792", "1972-05-15T00:00:00.000000Z", "57859", "1972-05-16T00:00:00.000000Z", "57926", "1972-05-17T00:00:00.000000Z", "57993", "1972-05-18T00:00:00.000000Z", "58060", "1972-05-19T00:00:00.000000Z", "58127", "1972-05-20T00:00:00.000000Z", "58194", "1972-05-21T00:00:00.000000Z", "58261", "1972-05-22T00:00:00.000000Z", "58328", "1972-05-23T00:00:00.000000Z", "58395", "1972-05-24T00:00:00.000000Z", "58462", "1972-05-25T00:00:00.000000Z", "58529", "1972-05-26T00:00:00.000000Z", "58596", "1972-05-27T00:00:00.000000Z", "58663", "1972-05-28T00:00:00.000000Z", "58731", "1972-05-29T00:00:00.000000Z", "58798", "1972-05-30T00:00:00.000000Z", "58865", "1972-05-31T00:00:00.000000Z", "58933", "1972-06-01T00:00:00.000000Z", "59000", "1972-06-02T00:00:00.000000Z", "59068", "1972-06-03T00:00:00.000000Z", "59135", "1972-06-04T00:00:00.000000Z", "59202", "1972-06-05T00:00:00.000000Z", "59269", "1972-06-06T00:00:00.000000Z", "59336", "1972-06-07T00:00:00.000000Z", "59403", "1972-06-08T00:00:00.000000Z", "59470", "1972-06-09T00:00:00.000000Z", "59537", "1972-06-10T00:00:00.000000Z", "59604", "1972-06-11T00:00:00.000000Z", "59671", "1972-06-12T00:00:00.000000Z", "59738", "1972-06-13T00:00:00.000000Z", "59805", "1972-06-14T00:00:00.000000Z", "59872", "1972-06-15T00:00:00.000000Z", "59939", "1972-06-16T00:00:00.000000Z", "60007", "1972-06-17T00:00:00.000000Z", "60074", "1972-06-18T00:00:00.000000Z", "60142", "1972-06-19T00:00:00.000000Z", "60209", "1972-06-20T00:00:00.000000Z", "60276", "1972-06-21T00:00:00.000000Z", "60343", "1972-06-22T00:00:00.000000Z", "60410", "1972-06-23T00:00:00.000000Z", "60477", "1972-06-24T00:00:00.000000Z", "60544", "1972-06-25T00:00:00.000000Z", "60611", "1972-06-26T00:00:00.000000Z", "60678", "1972-06-27T00:00:00.000000Z", "60745", "1972-06-28T00:00:00.000000Z", "60812", "1972-06-29T00:00:00.000000Z", "60879", "1972-06-30T00:00:00.000000Z", "60946", "1972-07-01T00:00:00.000000Z", "61013", "1972-07-02T00:00:00.000000Z", "61080", "1972-07-03T00:00:00.000000Z", "61147", "1972-07-04T00:00:00.000000Z", "61215", "1972-07-05T00:00:00.000000Z", "61282", "1972-07-06T00:00:00.000000Z", "61349", "1972-07-07T00:00:00.000000Z", "61416", "1972-07-08T00:00:00.000000Z", "61483", "1972-07-09T00:00:00.000000Z", "61550", "1972-07-10T00:00:00.000000Z", "61617", "1972-07-11T00:00:00.000000Z", "61684", "1972-07-12T00:00:00.000000Z", "61751", "1972-07-13T00:00:00.000000Z", "61818", "1972-07-14T00:00:00.000000Z", "61885", "1972-07-15T00:00:00.000000Z", "61952", "1972-07-16T00:00:00.000000Z", "62019", "1972-07-17T00:00:00.000000Z", "62086", "1972-07-18T00:00:00.000000Z", "62153", "1972-07-19T00:00:00.000000Z", "62220", "1972-07-20T00:00:00.000000Z", "62287", "1972-07-21T00:00:00.000000Z", "62354", "1972-07-22T00:00:00.000000Z", "62421", "1972-07-23T00:00:00.000000Z", "62489", "1972-07-24T00:00:00.000000Z", "62556", "1972-07-25T00:00:00.000000Z", "62625", "1972-07-26T00:00:00.000000Z", "62692", "1972-07-27T00:00:00.000000Z", "62759", "1972-07-28T00:00:00.000000Z", "62826", "1972-07-29T00:00:00.000000Z", "62893", "1972-07-30T00:00:00.000000Z", "62960", "1972-07-31T00:00:00.000000Z", "63027", "1972-08-01T00:00:00.000000Z", "63094", "1972-08-02T00:00:00.000000Z", "63161", "1972-08-03T00:00:00.000000Z", "63228", "1972-08-04T00:00:00.000000Z", "63295", "1972-08-05T00:00:00.000000Z", "63362", "1972-08-06T00:00:00.000000Z", "63429", "1972-08-07T00:00:00.000000Z", "63496", "1972-08-08T00:00:00.000000Z", "63563", "1972-08-09T00:00:00.000000Z", "63630", "1972-08-10T00:00:00.000000Z", "63699", "1972-08-11T00:00:00.000000Z", "63766", "1972-08-12T00:00:00.000000Z", "63833", "1972-08-13T00:00:00.000000Z", "63900", "1972-08-14T00:00:00.000000Z", "63967", "1972-08-15T00:00:00.000000Z", "64034", "1972-08-16T00:00:00.000000Z", "64101", "1972-08-17T00:00:00.000000Z", "64168", "1972-08-18T00:00:00.000000Z", "64236", "1972-08-19T00:00:00.000000Z", "64303", "1972-08-20T00:00:00.000000Z", "64371", "1972-08-21T00:00:00.000000Z", "64438", "1972-08-22T00:00:00.000000Z", "64505", "1972-08-23T00:00:00.000000Z", "64572", "1972-08-24T00:00:00.000000Z", "64639", "1972-08-25T00:00:00.000000Z", "64706", "1972-08-26T00:00:00.000000Z", "64774", "1972-08-27T00:00:00.000000Z", "64841", "1972-08-28T00:00:00.000000Z", "64908", "1972-08-29T00:00:00.000000Z", "64975", "1972-08-30T00:00:00.000000Z", "65042", "1972-08-31T00:00:00.000000Z", "65109", "1972-09-01T00:00:00.000000Z", "65176", "1972-09-02T00:00:00.000000Z", "65244", "1972-09-03T00:00:00.000000Z", "65311", "1972-09-04T00:00:00.000000Z", "65378", "1972-09-05T00:00:00.000000Z", "65445", "1972-09-06T00:00:00.000000Z", "65512", "1972-09-07T00:00:00.000000Z", "65579", "1972-09-08T00:00:00.000000Z", "65646", "1972-09-09T00:00:00.000000Z", "65714", "1972-09-10T00:00:00.000000Z", "65781", "1972-09-11T00:00:00.000000Z", "65848", "1972-09-12T00:00:00.000000Z", "65915", "1972-09-13T00:00:00.000000Z", "65982", "1972-09-14T00:00:00.000000Z", "66049", "1972-09-15T00:00:00.000000Z", "66116", "1972-09-16T00:00:00.000000Z", "66183", "1972-09-17T00:00:00.000000Z", "66250", "1972-09-18T00:00:00.000000Z", "66317", "1972-09-19T00:00:00.000000Z", "66384", "1972-09-20T00:00:00.000000Z", "66452", "1972-09-21T00:00:00.000000Z", "66519", "1972-09-22T00:00:00.000000Z", "66586", "1972-09-23T00:00:00.000000Z", "66653", "1972-09-24T00:00:00.000000Z", "66720", "1972-09-25T00:00:00.000000Z", "66787", "1972-09-26T00:00:00.000000Z", "66854", "1972-09-27T00:00:00.000000Z"
        };

        DateFormat dateFormat = new TimestampFormatCompiler().compile("yyyy-MM-ddTHH:mm:ss.SSSUUUZ");

        HashMap<String, LongList> map = new HashMap<>();

        for (int i = 0; i < inputs.length; i += 2) {
            long offset = Long.parseLong(inputs[i]);
            long ts = dateFormat.parse(inputs[i + 1], null);
            String year = inputs[i + 1].substring(0, 4);

            LongList target = map.get(year);
            if (target == null) {
                target = new LongList();
                map.put(year, target);
            }

            target.add(ts, offset);
        }

        for (Map.Entry<String, LongList> entry : map.entrySet()) {
            System.out.println("chunk( \"" + entry.getKey() + "\", ");
            LongList values = entry.getValue();

            System.out.print(values.get(0));

            for (int i = 1; i < values.size(); i++) {
                System.out.print("," + values.get(i));
            }
        }

    }

    private void assertIndexChunks(int workerCount, String fileName, IndexChunk... expectedChunks) throws Exception {
        assertIndexChunks(workerCount, "yyyy-MM-ddTHH:mm:ss.SSSZ", PartitionBy.DAY, fileName, expectedChunks);
    }

    private void assertIndexChunks(int workerCount, String dateFormat, int partitionBy, String fileName, IndexChunk... expectedChunks) throws Exception {
        assertIndexChunks(workerCount, dateFormat, partitionBy, -1/* use default */, fileName, expectedChunks);
    }

    private void assertIndexChunks(int workerCount, String dateFormat, int partitionBy, int bufferSize, String fileName, IndexChunk... expectedChunks) throws Exception {
        executeWithPool(workerCount, 8, bufferSize,
                (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) ->
                        assertIndexChunksFor(sqlExecutionContext, dateFormat, partitionBy, fileName, expectedChunks));
    }

    static IndexChunk chunk(String path, long... data) {
        return new IndexChunk(path, data);
    }

    static class IndexChunk {
        String path;
        long[] data;//timestamp+offset pairs

        IndexChunk(String path, long... data) {
            this.path = path;
            this.data = data;
        }

        @Override
        public String toString() {
            return "{" +
                    "path='" + path + '\'' +
                    ", data=" + Arrays.toString(data) +
                    '}';
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;
            IndexChunk that = (IndexChunk) o;
            return path.equals(that.path) && Arrays.equals(data, that.data);
        }

        @Override
        public int hashCode() {
            int result = Objects.hash(path);
            result = 31 * result + Arrays.hashCode(data);
            return result;
        }
    }

    static ObjList<IndexChunk> list(IndexChunk... chunks) {
        ObjList<IndexChunk> result = new ObjList<>(chunks.length);
        for (int i = 0; i < chunks.length; i++) {
            result.add(chunks[i]);
        }
        return result;
    }

    private void assertIndexChunksFor(SqlExecutionContext sqlExecutionContext, String format, int partitionBy, String fileName, IndexChunk... expectedChunks)
            throws SqlException, IOException {
        FilesFacade ff = engine.getConfiguration().getFilesFacade();
        inputRoot = new File("./src/test/resources/csv/").getAbsolutePath();

        try (Path path = new Path().of(inputRoot).slash().concat(fileName).$();
             FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {
            indexer.setMinChunkSize(1);
            DateFormat dateFormat = new TimestampFormatCompiler().compile(format);
            indexer.of(fileName, partitionBy, (byte) ',', 1, dateFormat, false);

            long fd = ff.openRO(path);
            Assert.assertTrue(fd > -1);

            try {
                indexer.findChunkBoundaries(fd);
                indexer.indexChunks();
            } finally {
                ff.close(fd);
            }
        }

        ObjList<IndexChunk> actualChunks = readIndexChunks(new File(inputWorkRoot, fileName));
        Assert.assertEquals(list(expectedChunks), actualChunks);
    }

    private ObjList<IndexChunk> readIndexChunks(File root) {
        List<File> indexChunks = findAllFilesIn(root);
        indexChunks.sort(Comparator.comparing(File::getAbsolutePath));

        Path p = new Path();
        MemoryCMARWImpl memory = new MemoryCMARWImpl();
        ObjList<IndexChunk> result = new ObjList<>();

        try {
            for (File chunk : indexChunks) {
                p.of(chunk.getAbsolutePath()).$();
                memory.smallFile(engine.getConfiguration().getFilesFacade(), p, MemoryTag.NATIVE_DEFAULT);
                long[] data = new long[(int) chunk.length() / Long.BYTES];

                for (int i = 0; i < data.length; i++) {
                    data[i] = memory.getLong(i * Long.BYTES);
                }

                result.add(new IndexChunk(chunk.getParentFile().getName() + "/" + chunk.getName(), data));
            }
        } finally {
            p.close();
            memory.close(false);
        }

        return result;
    }

    private List<File> findAllFilesIn(File root) {
        List<File> result = new ArrayList<>();
        File[] files = root.listFiles();
        for (File f : files) {
            if (f.isDirectory()) {
                result.addAll(findAllFilesIn(f));
            } else if (f.isFile()) {
                result.add(f);
            }
        }

        return result;
    }

    @Ignore
    @Test
    public void testSimpleCsv() throws Exception {
        executeWithPool(4, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) -> {
            //String inputDir = new File(".").getAbsolutePath();
            inputRoot = new File("E:/dev/tmp").getAbsolutePath();

            //try (Path path = new Path().of(inputDir).slash().concat("src/test/resources/csv/test-import.csv").$();
            try (FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {
                DateFormat dateFormat = new TimestampFormatCompiler().compile("yyyy-MM-ddTHH:mm:ss.SSSUUUZ");
                //unordered_trips_300mil.csv
                indexer.of("trips300mil.csv", PartitionBy.MONTH, (byte) ',', 2, dateFormat, true);
                indexer.process();
            }
        });
    }

    @Test
    public void testSimpleCsvWithPool() throws Exception {
        executeWithPool(4, 8, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) -> {
            //Thread.sleep(180000);
        });
    }

    @Test
    public void testProcessLargeCsvWithPool0() throws Exception {
        executeWithPool(8, 16, (CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) -> {
            FilesFacade ff = engine.getConfiguration().getFilesFacade();
            inputRoot = new File("./src/test/resources/csv/").getAbsolutePath();
            try (FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {
                DateFormat dateFormat = new TimestampFormatCompiler().compile("yyyy-MM-ddTHH:mm:ss.SSSZ");
                indexer.setMinChunkSize(10);
                indexer.of("test-import.csv", PartitionBy.YEAR, (byte) ',', 4, dateFormat, true);
                indexer.process();
            }
        });
    }

    @Test
    public void testIndexSort() throws Exception {
        FilesFacade ff = engine.getConfiguration().getFilesFacade();
        try (Path path = new Path().of(inputRoot).slash().concat("chunk").$();
             FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {

            MemoryPMARImpl chunk = new MemoryPMARImpl(ff, path, ff.getPageSize(), MemoryTag.MMAP_DEFAULT, CairoConfiguration.O_NONE);
            try {
                long lo = 0;
                long hi = Long.MAX_VALUE;
                long range = hi - lo + 1;
                for (int i = 0; i < 10; i++) {
                    final long z = lo + rnd.nextPositiveLong() % range;
//                    final long z = 10 - i;
                    chunk.putLong(z);
                    chunk.putLong(i);
                }
            } finally {
                chunk.close(true, Vm.TRUNCATE_TO_POINTER);
            }

            //indexer.sort(path)//TODO: TEST !
            long len = ff.length(path.$());
            try (MemoryCMRImpl sorted = new MemoryCMRImpl(ff, path.$(), len, MemoryTag.MMAP_DEFAULT)) {
                long offset = 0;
                while (offset < len) {
                    long ts = sorted.getLong(offset);
                    long id = sorted.getLong(offset + 8);
                    System.err.println(ts);
                    System.err.println(id);
                    offset += 16;
                }
            }
            ff.remove(path);
//            System.err.println("---------------");
//            try(MemoryCMRImpl sorted = new MemoryCMRImpl(ff, path.chop$().put(".s").$(), len, MemoryTag.MMAP_DEFAULT)) {
//                long offset = 0;
//                while (offset < len) {
//                    long ts = sorted.getLong(offset);
//                    long id = sorted.getLong(offset + 8);
//                    System.err.println(ts);
//                    System.err.println(id);
//                    offset += 16;
//                }
//            }
        }
    }

    private void createAndSortChunkFiles(Path path, int nChunks, int chunkSizeMin, int chunkSizeMax) throws IOException {
        FilesFacade ff = engine.getConfiguration().getFilesFacade();
        int plen = path.length();
        for (int i = 0; i < nChunks; i++) {
            path.trimTo(plen);
            path.slash().concat("chunk").put(i).$();
            try (FileIndexer indexer = new FileIndexer(sqlExecutionContext)) {
                long rng = chunkSizeMax - chunkSizeMin + 1;
                final long count = chunkSizeMin + rnd.nextPositiveLong() % rng;

                MemoryPMARImpl chunk = new MemoryPMARImpl(ff, path, ff.getPageSize(), MemoryTag.MMAP_DEFAULT, CairoConfiguration.O_NONE);
                try {
                    long lo = 0;
                    long hi = Long.MAX_VALUE;
                    long range = hi - lo + 1;
                    for (int v = 0; v < count; v++) {
                        final long z = lo + rnd.nextPositiveLong() % range;
                        chunk.putLong(z);
                        chunk.putLong(v);
                    }
                } finally {
                    chunk.close(true, Vm.TRUNCATE_TO_POINTER);
                }
                //indexer.sort(path);//TODO: fix 
            }
        }
        path.trimTo(plen);
    }

    protected void executeWithPool(
            int workerCount,
            int queueCapacity,
            TextImportRunnable runnable
    ) throws Exception {
        executeWithPool(workerCount, queueCapacity, -1, runnable);
    }

    protected void executeWithPool(
            int workerCount,
            int queueCapacity,
            int readBufferSize,
            TextImportRunnable runnable
    ) throws Exception {
        executeVanilla(() -> {
            if (workerCount > 0) {

                int[] affinity = new int[workerCount];
                for (int i = 0; i < workerCount; i++) {
                    affinity[i] = -1;
                }

                WorkerPool pool = new WorkerPool(
                        new WorkerPoolAwareConfiguration() {
                            @Override
                            public int[] getWorkerAffinity() {
                                return affinity;
                            }

                            @Override
                            public int getWorkerCount() {
                                return workerCount;
                            }

                            @Override
                            public boolean haltOnError() {
                                return false;
                            }

                            @Override
                            public boolean isEnabled() {
                                return true;
                            }
                        },
                        Metrics.disabled()
                );

                final CairoConfiguration configuration = new DefaultCairoConfiguration(root) {
                    @Override
                    public FilesFacade getFilesFacade() {
                        return FilesFacadeImpl.INSTANCE;
                    }

                    @Override
                    public CharSequence getInputWorkRoot() {
                        return FileSplitterTest.inputWorkRoot;
                    }

                    @Override
                    public CharSequence getInputRoot() {
                        return FileSplitterTest.inputRoot;
                    }

                    @Override
                    public int getSqlCopyBufferSize() {
                        if (readBufferSize > 0) {
                            return readBufferSize;
                        }
                        return super.getSqlCopyBufferSize();
                    }
                };

                execute(pool, runnable, configuration);
            } else {
                // we need to create entire engine
                final CairoConfiguration configuration = new DefaultCairoConfiguration(root) {
                    @Override
                    public FilesFacade getFilesFacade() {
                        return FilesFacadeImpl.INSTANCE;
                    }

                    @Override
                    public int getLatestByQueueCapacity() {
                        return queueCapacity;
                    }
                };
                execute(null, runnable, configuration);
            }
        });
    }

    protected static void execute(
            @Nullable WorkerPool pool,
            TextImportRunnable runnable,
            CairoConfiguration configuration
    ) throws Exception {
        final int workerCount = pool == null ? 1 : pool.getWorkerCount();
        try (
                final CairoEngine engine = new CairoEngine(configuration);
                final SqlCompiler compiler = new SqlCompiler(engine)
        ) {
            try (final SqlExecutionContext sqlExecutionContext = new SqlExecutionContextImpl(engine, workerCount)
            ) {
                try {
                    if (pool != null) {
                        pool.assignCleaner(Path.CLEANER);
                        pool.assign(new TextImportJob(engine.getMessageBus())); //todo: copy-pasted, refactor this
                        pool.start(LOG);
                    }

                    runnable.run(engine, compiler, sqlExecutionContext);
                    Assert.assertEquals(0, engine.getBusyWriterCount());
                    Assert.assertEquals(0, engine.getBusyReaderCount());
                } finally {
                    if (pool != null) {
                        pool.halt();
                    }
                }
            }
        }
    }

    static void executeVanilla(TestUtils.LeakProneCode code) throws Exception {
        TestUtils.assertMemoryLeak(code);
    }

    @FunctionalInterface
    interface TextImportRunnable {
        void run(CairoEngine engine, SqlCompiler compiler, SqlExecutionContext sqlExecutionContext) throws Exception;
    }
}

